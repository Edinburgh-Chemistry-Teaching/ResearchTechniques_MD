<!DOCTYPE html>
<html lang="en-UK">
<!--xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">-->

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
    <meta content="Session 2: Protein Simulations" name="description"/>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,400;0,600;1,400&display=swap"
          rel="stylesheet">
    <link href="../scripts/style.css" rel="stylesheet"/>
    <title>Session 2</title>
</head>

<body>

<div class="box">
    <h1 id="title">Protein Simulations</h1>
    <!--    <p><strong>Contact:</strong><br/>-->
    <!--        Dr Valentina Erastova (<a href="mailto:valentina.erastova@ed.ac.uk">valentina.erastova@ed.ac.uk</a>)<br/>-->
    <!--        Office B21 (Office hours Wedn 10.00&dash;12.00 in weeks 3, 4 and 5)-->
    <!--    </p>-->
    <!--    <p><strong>Demonstrators:</strong></p>-->
    <!--    <ul>-->
    <!--        <li>Hannah Pollak</li>-->
    <!--        <li>Audrey Noumbissi Ngambia</li>-->
    <!--        <li>Sarah Stewart</li>-->
    <!--        <li>Finlay Clark</li>-->
    <!--    </ul>-->
</div>

<div class="box">
    <h2 id="outcomes">Learning Outcomes</h2>
    <p>
        By the end of this session you should be able to
    </p>
    <ul>
        <li>Understand the basics of molecular dynamics simulations</li>
        <li>Set up a simulation of a protein in water</li>
        <li>Run a simulation with GROMACS and analyse the output</li>
        <li>Visualise the structures and trajectories in VMD</li>
        <li>Visualise analysis results with XMGrace</li>
    </ul>
</div>

<div class="box">
    <h2 id="overview">Contents</h2>
</div>
<div class="box">
    <h2 class="enum" id="toc_1">Introduction</h2>
    <p>
        In this practical session, we will learn the basics of Molecular Dynamics (MD) simulations with GROMACS, and use
        of assisting software (e.g. VMD, xmgrace, gedit) to visualise and manipulate the data.
    </p>
    <p>
        <span style="font-weight: bolder"><abbr>GROMACS</abbr></span> (GROningen MAchine for Chemical Simulations) is a
        software package for <abbr>MD</abbr>
        simulations.
    <blockquote>
        <p>GROMACS is a versatile package to perform molecular dynamics, i.e. simulate the Newtonian equations of motion
            for
            systems with hundreds to millions of particles and is a community&dash;driven project.
            [...] It is primarily designed for biochemical molecules like proteins, lipids and nucleic acids that have a
            lot of
            complicated bonded interactions, but since GROMACS is extremely fast at calculating the nonbonded
            interactions
            (that usually dominate simulations) many groups are also using it for research on non&dash;biological
            systems,
            e.g.
            polymers.</p>

        <footer>from <cite>About GROMACS (<a href="https://www.gromacs.org/about.html">www.gromacs.org/about.html)</a>
        </cite></footer>
    </blockquote>
    <p>For everyday general molecular simulations, GROMACS is one of the fastest MD programs. It is also quite flexible,
        so
        apart from proteins and biomolecules in general, it can be used to simulate a vast range of different types of
        molecules. If you want to use it on your own machine, you can download GROMACS from <a
                href="https://manual.gromacs.org/current/download.html">manual.gromacs.org/current/download.html</a> or
        on Linux use <code>apt&dash;get install
            gromacs</code> and on Mac via homebrew <code>brew install gromacs</code>.</p>

    <p>GROMACS is commonly available on <abbr>HPCs</abbr> (high performance computers), including the University&rsquo;s
        Eddie <abbr>HPC</abbr>, and also
        Tier 2 and Tier 1 (national supercomputers) such as Cirrus or Archer.</p>
    <p>
        It was originally developed in the University of Groningen, but now is
        maintained and extended at different places, including the University of Uppsala, University of Stockholm and
        the Max Planck Institute for Polymer Research. It is an open source software, released under the
        <abbr>GPL</abbr> (general public licence), which means that is free to use.
        There are many more tutorials for GROMACS available. Some can be found on: <a
            href="http://www.mdtutorials.com/gmx/">www.mdtutorials.com/gmx</a>.
    </p>

    <p>
        <span style="font-weight: bolder"><abbr>VMD</abbr></span> (Visual Molecular Dynamics) is a program for
        visualising molecules, and can be used to view
        the output of GROMACS simulations. It is also free and can run on Linux, Mac and Windows.
        It can be downloaded from <a href="https://www.ks.uiuc.edu/Development/Download/download.cgi?PackageName=VMD">www.ks.uiuc.edu/Development/Download/</a>.
        An
        extensive user guide and tutorials are available at <a href="https://www.ks.uiuc.edu/Research/vmd/current/ug/">www.ks.uiuc.edu/Research/vmd/current/ug</a>
        and <a href="https://www.ks.uiuc.edu/Training/Tutorials/">www.ks.uiuc.edu/Training/Tutorials</a>.

    </p>
    <p>
        <span style="font-weight: bolder"><abbr>XMGrace</abbr></span> is a free program for plotting data that runs on
        Linux, Mac and Windows. It
        can be downloaded from <a href="https://plasma-gate.weizmann.ac.il/pub/grace/">plasma&dash;gate.weizmann.ac.il/pub/grace</a>.
        An user guide for can be found at <a href="https://plasma-gate.weizmann.ac.il/Grace/doc/UsersGuide.html">plasma&dash;gate.weizmann.ac.il/Grace/doc/UsersGuide.html</a>.
    </p>
    <p>
        <span style="font-weight: bolder"><abbr>gedit</abbr></span> is a free text editor for Linux, Mac and Windows
        Installation instructions can be found at <a
            href="https://wiki.gnome.org/Apps/Gedit">wiki.gnome.org/Apps/Gedit</a>.
    </p>
</div>
<div class="box">
    <p>
        <em>This tutorial was created by Hannah Pollak and Valentina Erastova and is based upon the <a
                href="https://tutorials.gromacs.org/docs/md-intro-tutorial.html">Molecular dynamics simulation of a
            small protein using GROMACS tutorial</a> by Alessandra Villa which was adapted from the
            <a href="http://www.mdtutorials.com/gmx/lysozyme/index.html">Lysozyme in Water Tutorial</a> by Justin
            A. Lemkuhl.</em>
    </p>
    <p>Every simulation needs to start with a structure. Even though a lot of computational efforts have been done, it
        is
        still not possible to computationally predict the tertiary structure of the protein from its primary one, i.e.
        its
        amino
        acid sequence. This would require inaccessible computational powers and times. </p>

    <p>For this reason, normally a 3D structure predicted from X&dash;ray diffraction is used as a starting point. Here,
        we
        will
        be downloading a protein structure from the <abbr>PDB</abbr> (Protein Data Dank) <a
                href="https://www.rcsb.org">www.rcsb.org</a></p>

    <blockquote>
        <p>A quick word of warning is appropriate. Experimental data is not perfect. Therefore, it is possible for
            crystal
            structures in the PDB database to contain errors such as missing atoms. These &ldquo;errors&ldquo; are
            usually caused by
            experiment
            being unable to clearly &ldquo;see&ldquo; amino acid side&dash;chains within the protein crystal because of
            its
            molecular
            motion.
            In some cases, it is necessary to &ldquo;clean up&ldquo; a protein structure before using it in a simulation
            study. Good
            programs for doing this include, coot <a
                    href="https://sbcb.bioch.ox.ac.uk/teaching/coot_tutorial.pdf">sbcb.bioch.ox.ac.uk/teaching/coot_tutorial.pdf</a>
            and the Swiss&dash;PdbViewer
            (DeepView) <a href="https://spdbv.unil.ch/">spdbv.unil.ch</a></p>
    </blockquote>

    <p>The structures in the PDB are stored by a codename. Here is a selection of structures that do not require any
        further
        processing, so make a pick for a structure to work with: </p>

    <ul>
        <li>Human prion &dash; <a href="https://www.rcsb.org/structure/1QLZ">1QLZ</a></li>
        <li>Elk prion &dash; <a href="https://www.rcsb.org/structure/1XYW">1XYW</a></li>
        <li>Chicken prion &dash; <a href="https://www.rcsb.org/structure/1U3M">1U3M</a></li>
        <li>Clawed frog prion &dash; <a href="https://www.rcsb.org/structure/1XU0">1XU0</a></li>
        <li>Hen egg&dash;white lysozyme &dash; <a href="https://www.rcsb.org/structure/1AKI">1AKI</a></li>
        <li>Spider toxin &dash; <a href="https://www.rcsb.org/structure/1OMB">1OMB</a></li>
        <li>Ubiquin &dash; <a href="https://www.rcsb.org/structure/1UBQ">1UBQ</a></li>
    </ul>


    <p>The figure below shows a typical protocol for the simulation of protein in the box. In this tutorial, we will
        follow
        this same protocol.</p>
    <!--    <div class="flex-figure">-->
    <!--        <div class="flex-figure-img">-->
    <!--            <figure>-->
    <!--                <img src="img/gmx_workflow.png" alt="gmx workflow">-->
    <!--                <figcaption>Typical flowchart of a simulation of protein in water, often a number of simulations have to-->
    <!--                    be performed-->
    <!--                    to prepare the system for a production MD run, the interactive flowchart can be found at <a-->
    <!--                            href="https://manual.gromacs.org/current/user-guide/flow.html">manual.gromacs.org/current/user-guide/flow.html</a>-->
    <!--                </figcaption>-->
    <!--            </figure>-->
    <!--        </div>-->
    <!--    </div>-->
    <div class="flex-figure">
        <div class="flex-figure-img" style="width: 70%">
            <figure>
                <div class="graphviz"><img
                        alt="digraph flowchart {
node [ shape=box, width=1.5 ]

input_pdb [
  label=&quot;eiwit.pdb&quot;
  tooltip=&quot;Protein Databank file&quot;
  URL=&quot;../reference-manual/file-formats.html#pdb&quot;
  shape=none, width=0, height=0, margin=0
  group=input
]
pdb2gmx [
  label=&quot;Generate a GROMACS topology\ngmx pdb2gmx&quot;
  tooltip=&quot;Convert PDB file to GROMACS coordinate file and topology&quot;
  URL=&quot;../onlinehelp/gmx-pdb2gmx.html&quot;
  width=3
  group=main
]

input_pdb -> pdb2gmx [ headport=e ]

editconf [
  label=&quot;Enlarge the box\ngmx editconf&quot;
  tooltip=&quot;Adjust box size and placement of molecule&quot;
  URL=&quot;../onlinehelp/gmx-editconf.html&quot;
]

pdb2gmx -> editconf [
  label=&quot;conf.gro&quot;
  labeltooltip=&quot;GROMACS coordinate file containing molecules from PDB file&quot;
  URL=&quot;../reference-manual/file-formats.html#gro&quot;
]

solvate [
  label=&quot;Solvate protein\ngmx solvate&quot;
  tooltip=&quot;Fill box with water (solvate molecule)&quot;
  URL=&quot;../onlinehelp/gmx-solvate.html&quot;
  width=3
  group=main
]

pdb2gmx -> solvate [
  label=&quot;topol.top&quot;
  labeltooltip=&quot;GROMACS ascii topology file&quot;
  URL=&quot;../reference-manual/file-formats.html#top&quot;
]
editconf -> solvate [
  label=&quot;conf.gro&quot;
  labeltooltip=&quot;GROMACS coordinate file with adjusted box etc.&quot;
  URL=&quot;../reference-manual/file-formats.html#gro&quot;
]

input_mdp [
  label=&quot;grompp.mdp&quot;
  tooltip=&quot;Parameter file from grompp (controls all MD parameters)&quot;
  URL=&quot;../reference-manual/file-formats.html#mdp&quot;
  shape=none, width=0, height=0, margin=0
  group=input
]
grompp [
  label=&quot;Generate mdrun input file\ngmx grompp&quot;
  tooltip=&quot;Process parameters, coordinates and topology and write binary topology&quot;
  URL=&quot;../onlinehelp/gmx-grompp.html&quot;
  width=3
  group=main
]

input_pdb -> input_mdp [ style=invis, minlen=3 ]

input_mdp -> grompp [ headport=e, weight=0 ]
solvate -> grompp [
  label=&quot;conf.gro&quot;
  labeltooltip=&quot;GROMACS coordinate file with water molecules added&quot;
  URL=&quot;../reference-manual/file-formats.html#gro&quot;
]
solvate -> grompp [
  label=&quot;topol.top&quot;
  labeltooltip=&quot;GROMACS ascii topology file with water molecules added&quot;
  URL=&quot;../reference-manual/file-formats.html#top&quot;
]

mdrun [
  label=&quot;Run the simulation (EM or MD)\ngmx mdrun&quot;
  tooltip=&quot;The moment you have all been waiting for! START YOUR MD RUN&quot;
  URL=&quot;../onlinehelp/gmx-mdrun.html&quot;
  width=3
  group=main
]

grompp -> mdrun [
  label=&quot;topol.tpr&quot;
  labeltooltip=&quot;Portable GROMACS binary run input file (contains all information to start MD run)&quot;
  URL=&quot;../reference-manual/file-formats.html#tpr&quot;
]
mdrun -> mdrun [
  label=&quot;Continuation\nstate.cpt&quot;
  labeltooltip=&quot;Checkpoint file&quot;
  URL=&quot;../reference-manual/file-formats.html#cpt&quot;
]

analysis [
  label=&quot;Analysis\ngmx ...&quot;
  tooltip=&quot;Your favourite GROMACS analysis tool&quot;
  URL=&quot;cmdline.html#commands-by-topic&quot;
]

mdrun -> analysis [
  label=&quot;traj.xtc / traj.trr&quot;
  labeltooltip=&quot;Portable compressed trajectory / full precision portable trajectory&quot;
  URL=&quot;../reference-manual/file-formats.html#xtc&quot;
]

energy [
  label=&quot;Analysis\ngmx energy&quot;
  tooltip=&quot;Energy plots, averages and fluctuations&quot;
  URL=&quot;../onlinehelp/gmx-energy.html&quot;
]

mdrun -> energy [
  label=&quot;ener.edr&quot;
  labeltooltip=&quot;Portable energy file&quot;
  URL=&quot;../reference-manual/file-formats.html#edr&quot;
]
}"
                        class="graphviz"
                        src="https://manual.gromacs.org/current/_images/graphviz-546f8676b043be7a824d2ab2320a5e60473f82fc.png"
                        usemap="#flowchart">
                </div>
                <map id="flowchart" name="flowchart">
                    <area alt="" coords="413,5,503,25" href="../reference-manual/file-formats.html#pdb"
                          id="node1" shape="rect" title="Protein Databank file">
                    <area alt="" coords="67,75,391,125" href="../onlinehelp/gmx-pdb2gmx.html"
                          id="node2" shape="rect"
                          title="Convert PDB file to GROMACS coordinate file and topology">
                    <area alt="" coords="397,327,519,347" href="../reference-manual/file-formats.html#mdp"
                          id="node5" shape="rect"
                          title="Parameter file from grompp (controls all MD parameters)">
                    <area alt="" coords="5,193,180,244" href="../onlinehelp/gmx-editconf.html"
                          id="node3" shape="rect" title="Adjust box size and placement of molecule">
                    <area alt="" coords="169,128,135,151,111,182,107,179,131,147,166,123"
                          href="../reference-manual/file-formats.html#gro" id="edge2"
                          shape="poly" title="conf.gro">
                    <area alt="" coords="133,149,210,169" href="../reference-manual/file-formats.html#gro"
                          id="edge2-label" shape="rect"
                          title="GROMACS coordinate file containing molecules from PDB file">
                    <area alt="" coords="85,312,373,363" href="../onlinehelp/gmx-solvate.html"
                          id="node4" shape="rect" title="Fill box with water (solvate molecule)">
                    <area alt="" coords="231,126,231,298,226,298,226,126"
                          href="../reference-manual/file-formats.html#top" id="edge3"
                          shape="poly" title="topol.top">
                    <area alt="" coords="229,209,314,229" href="../reference-manual/file-formats.html#top"
                          id="edge3-label" shape="rect" title="GROMACS ascii topology file">
                    <area alt="" coords="105,243,118,265,135,286,157,303,154,307,131,290,113,268,100,246"
                          href="../reference-manual/file-formats.html#gro" id="edge4"
                          shape="poly" title="conf.gro">
                    <area alt="" coords="133,268,210,288" href="../reference-manual/file-formats.html#gro"
                          id="edge4-label" shape="rect" title="GROMACS coordinate file with adjusted box etc.">
                    <area alt="" coords="66,431,354,481" href="../onlinehelp/gmx-grompp.html"
                          id="node6" shape="rect"
                          title="Process parameters, coordinates and topology and write binary topology">
                    <area alt="" coords="196,364,179,388,177,403,182,418,177,420,172,403,174,386,192,361"
                          href="../reference-manual/file-formats.html#gro" id="edge7"
                          shape="poly" title="conf.gro">
                    <area alt="" coords="177,387,254,407" href="../reference-manual/file-formats.html#gro"
                          id="edge7-label" shape="rect" title="GROMACS coordinate file with water molecules added">
                    <area alt="" coords="249,362,258,384,257,407,250,421,245,418,251,406,253,385,244,364"
                          href="../reference-manual/file-formats.html#top" id="edge8"
                          shape="poly" title="topol.top">
                    <area alt="" coords="255,387,341,407" href="../reference-manual/file-formats.html#top"
                          id="edge8-label" shape="rect"
                          title="GROMACS ascii topology file with water molecules added">
                    <area alt="" coords="49,549,371,600" href="../onlinehelp/gmx-mdrun.html"
                          id="node7" shape="rect"
                          title="The moment you have all been waiting for! START YOUR MD RUN">
                    <area alt="" coords="213,481,213,536,207,536,207,481"
                          href="../reference-manual/file-formats.html#tpr" id="edge9"
                          shape="poly" title="topol.tpr">
                    <area alt="" coords="210,505,294,525" href="../reference-manual/file-formats.html#tpr"
                          id="edge9-label"
                          shape="rect"
                          title="Portable GROMACS binary run input file (contains all information to start MD run)">
                    <area alt="" coords="372,563,390,567,398,575,386,583,384,579,393,574,388,572,371,569"
                          href="../reference-manual/file-formats.html#cpt"
                          id="edge10" shape="poly"
                          title="Continuation\nstate.cpt">
                    <area alt="" coords="395,555,519,595" href="../reference-manual/file-formats.html#cpt"
                          id="edge10-label" shape="rect" title="Checkpoint file">
                    <area alt="" coords="46,668,190,719" href="cmdline.html#commands-by-topic"
                          id="node8" shape="rect" title="Your favourite GROMACS analysis tool">
                    <area alt=""
                          coords="145,602,132,613,122,625,116,639,115,654,109,654,111,638,117,623,128,609,142,598"
                          href="../reference-manual/file-formats.html#xtc"
                          id="edge11" shape="poly"
                          title="traj.xtc / traj.trr">
                    <area alt="" coords="119,624,273,644" href="../reference-manual/file-formats.html#xtc"
                          id="edge11-label" shape="rect"
                          title="Portable compressed trajectory / full precision portable trajectory">
                    <area alt="" coords="230,668,374,719" href="../onlinehelp/gmx-energy.html"
                          id="node9" shape="rect" title="Energy plots, averages and fluctuations">
                    <area alt="" coords="250,598,275,622,292,654,288,656,271,626,246,602"
                          href="../reference-manual/file-formats.html#edr" id="edge12"
                          shape="poly" title="ener.edr">
                    <area alt="" coords="283,624,363,644" href="../reference-manual/file-formats.html#edr"
                          id="edge12-label" shape="rect" title="Portable energy file">
                </map>
                <figcaption>
                    <figcaption>Typical flowchart of a simulation of protein in water, often a number of simulations
                        have to
                        be performed
                        to prepare the system for a production MD run, the interactive flowchart can be found at <a
                                href="https://manual.gromacs.org/current/user-guide/flow.html">manual.gromacs.org/current/user&dash;guide/flow.html</a>
                    </figcaption>
                </figcaption>
            </figure>
        </div>
    </div>
</div>

<div class="box">
    <h2 class="enum" id="toc_2">Preparing the system for simulation</h2>
    <p>
        Before you start on this practical, let's create a working directory for this session.
    </p>
    <p style="font-weight: bold">In this session, all the commands will need to be typed. If you copy them from this
        document, they won't work! Use <code>Tab</code> to autocomplete and save time.</p>
    <div class="bbox">
        <h3 id="Creating_the_working_directory"></h3>
        <ul>
            <li>Create the working directory for this session</li>
            <li>Move to your home directory:
                <pre>$ cd </pre>
            </li>
            <li>Copy the <code>session2</code> folder from practicals to your home directory:
                <p>Open a terminal and type:</p>
                <pre>$ cp &dash;r /home/student/practicals/session2 .</pre>
            </li>
            <li>Change into the <code>session2</code> directory:
                <pre>$ cd session2</pre>
            </li>
        </ul>
    </div>
    <p>
        Let's get started! Choose your favourite protein structure from the list above and go through the tasks below.
    </p>
    <div class="bbox">
        <h3 id="Downloading_the_protein_structure"></h3>
        <ol>
            <li>Download the protein structure file into the <code>session2</code> directory<br>
                There are two ways to do download the structure:
                <ol>
                    <li>
                        Download the file in the terminal using <code>wget</code> command:<br>
                        Usage of <code>wget</code>:
                        <blockquote>
                            <pre>$ wget URL</pre>
                            E.g. for the protein 1xyw.pdb, the command would be:
                            <pre>$ wget http://www.rcsb.org/pdb/files/1xyw.pdb .</pre>
                            <p class="note">The <code>.</code> at the end of the command means that the file will be
                                downloaded into the current directory so make sure you are in the newly created
                                <code>session2</code> directory before running the command.</p>
                            <p style="font-weight: bolder">Replace <code>1xyw</code> with the code of the protein of
                                your choice.</p>
                        </blockquote>
                    </li>
                    <li>
                        Download the file manually from the web (<a href="http://www.rcsb.org">www.rcsb.org</a>) and
                        move it
                        into the <code>session2</code> directory.
                    </li>
                </ol>
            </li>
            <li>Use the <code>more</code> or <code>less</code> command to read through the file.

                <blockquote>
                    <pre>$ more 1xyw.pdb</pre>
                    <pre>$ less 1xyw.pdb</pre>
                    To scroll down use <code>Space</code>, to exit the viewer press <code>Ctrl+C</code> or
                    <code>q</code>.
                    Familiarise yourself with the file format. The file contains information about the protein amino
                    acid residue (e.g. LEU and GLY etc.) and also the atom name inside the residue.
                    <ul>
                        <li>
                            <code>REMARK</code> lines are comments.
                        </li>
                        <li>
                            <code>ATOM</code> lines contain atom coordinates
                        </li>
                        <li>
                            <code>CONNECT</code> lines contain connection information.
                            <p class="note"> Where this information is absent, bonds can be inferred from atomic
                                positions
                                by the programs below.</p>
                        </li>
                    </ul>
                </blockquote>
            </li>
            <li>Rename the file to <code>protein.pdb</code>
                <pre>$ cp 1xyw.pdb protein.pdb</pre>
            </li>
        </ol>
    </div>
    <p>
        Now that you have the protein structure, you can visualise it in VMD.
    </p>
    <div class="bbox">
        <h3 id="Visualising_the_protein_in_VMD"></h3>
        <ol>
            <li>Open VMD and visualise the protein structure</li>
            <li>Open VMD<br>
                Open a terminal window and type <code>vmd</code> to open VMD.
            </li>
            <li>Load the protein structure into VMD:
                <blockquote>
                    In the main window, click <code>File</code> &#8594;
                    <code>New Molecule ...</code> and select your <code>.pdb</code> file.
                    <p class="note">The startup of VMD opens two separate windows.</p>
                    <p class="note">If you don't see your file name there, you need to write the path to your
                        <code>session2</code> folder in the <code>Molecule File Browser</code> window.</p>
                </blockquote>
            </li>
            <li>Play around with the visualisation options
                <blockquote>
                    You can move the molecule around by clicking and dragging the mouse.
                    Press <code>R</code> to rotate the molecule (default), <code>T</code> to translate it and
                    <code>S</code> to scale it.
                    Click on <code>Display</code> &#8594; <code>Reset view</code> to reset the view.
                </blockquote>
            </li>
            <li id="change_rep">Change the representation of the molecule
                <blockquote>
                    Click on <code>Graphics</code> &#8594; <code>Representations</code> and change <code>Drawing
                    Method</code> or <code>Coloring Method</code> to see how the molecule representation changes.
                    For proteins, the <code>New Cartoon</code> representation is often used. It only shows the backbone
                    and is useful to visualise the higher structure of the protein. <br>
                    You can also change the representation of a subset of atoms by selecting them in the <code>Graphical
                    Representations</code> window.
                    For this, click on <code>Create Rep</code> inside the <code>Graphical Representations</code> window.
                    In the <code>Selected Atoms</code> field you can replace the <code>all</code> by a selection
                    command.
                    E.g. to select all atoms of the residue with the number 10, you can use <code>resid 10</code>, for
                    all atoms of the residue with the name <code>GLY</code> use <code>resname GLY</code>, etc.
                    You can find more information about selection commands in the <abbr>VMD</abbr> user guide: <a
                        href="https://www.ks.uiuc.edu/Research/vmd/current/ug/node89.html">www.ks.uiuc.edu/Research/vmd/current/ug/node89.html</a>.
                </blockquote>
            </li>
        </ol>
        <div class="flex-figure">
            <div class="flex-figure-img" style="width: 50%">
                <figure>
                    <img alt="1xyw.pdb in VMD" src="img/1xyw.png" width="100%">
                    <figcaption>New Cartoon representation of the 1xyw.pdb structure in <abbr>VMD</abbr>.</figcaption>
                </figure>
            </div>
        </div>
        <p class="note"><abbr>VMD</abbr> has a lot of other useful features, which you can explore in your own time.
            <br>Besides visualising molecules, it can also be used to render images and movies of structures and
            trajectories. Among others,
            it even has functionalities to build and manipulate molecules and analyse trajectories.
        </p>
    </div>
    <h3 class="enum" id="toc_2_1">Notes on organising and naming files</h3>
    <p>
        As you start to work on the tutorial, let's talk about how to organise your work. Over the course of tutorial, a
        lot of files will be generated. Unless you specify the names of outpout files, GROMACS will use default names
        for them. This will cause existing files to be overwritten by new ones.</p>
    <p class="note"> GROMACS does back up old files, renaming
        them to <code>&lt;#filename&gt;.&lt;extension&gt;.1#</code> before overwriting.</p>
    <p>
        To be able to retrieve your data
        later and to not get confused, make sure to keep your work organised and name files coherently.
        It would be advisable to run each simulation step in a different subdirectory or to (re)name input and output
        files
        in a descriptive matter.</p>
    <p><em>Remember:</em><br>
        You can copy files with
        <code>cp &lt;old_file.gro&gt; &lt;new_file&gt;</code><br> and move files with
        <code>mv &lt;old_file.gro&gt; &lt;new_file&gt;</code>
    </p>
    <p class="note"> The second option is riskier as you might not be aware of all the files
        that get by GROMACS generated and all the output names that you might need to specify.</p>

    <h3 class="enum" id="toc_2_2">Checking the input protein structure</h3>
    <p>
        As mentioned before, it is quite common for some residues or atoms to be missing in an experimental protein
        structure. It is, therefore, essential to first check and fix all errors in the input structure
        before running any <abbr>MD</abbr> simulation. </p>
    <p>
        The structures of the proteins used in this tutorial are fully resolved, so you
        do not need to worry about this step.
        However, it is worth mentioning that one of the biggest tasks for a biological simulation in practice is to
        prepare
        and check structures prior to simulation. </p>
    <p>Another challenge is posed by non&dash;standard groups in molecules.
        These could consist of non&dash;standard residues, modified residues or ligands, for which force field
        parameters
        are not yet available. Considerable work is often required to either eliminate these groups, modify them, or
        determine the missing force field parameters by reference to the literature and/or use of quantum chemical
        calculations. The structures in this tutorial only consist of natural amino acids, for which quite reasonable
        force field parameters exist for use with GROMACS.</p>
    <p>
        Additionally, after the refinement process in crystal structure determination, the resulting structure should be
        checked for:
    </p>
    <ul>
        <li>Proper orientations of glutamine and asparagine amide groups</li>
        <li>Consistent protonation state and side chain orientation of histidine residues</li>
        <li>Any other problems with the system</li>
    </ul>
    <p>
        A number of tools have been developed specifically for this purpose, but here, we will assume that the crystal
        structures obtained from the <abbr>PDB</abbr> are correct.
    </p>
    <h3 class="enum" id="toc_2_3">Creating coordinate and topology files for the simulation with GROMACS</h3>
    <p>
        Since <abbr>MD</abbr> simulations rely on force fields to describe the interactions of atoms, having an atomic
        structure alone is not enough. We need to add a topology (i.e. a description of the system's
        covalent network).
        Connectivity information is necessary in order to calculate inter&dash;atomic interactions as defined in the
        force field used in the simulation. GROMACS comes with a range of internal force fields and the
        <code>pdb2gmx</code> command to assign them to protein structures.
    </p>
    <p class="note"> This only works on perfect proteins.</p>

    <div class="bbox">
        <h3 id="Creating_a_topology"></h3>
        <ul>
            <li>Use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-pdb2gmx.html"><code>pdb2gmx</code></a> to
                create a topology for the protein structure
            </li>
            <li>
                <p>
                    To run a <abbr>GROMACS</abbr> command in the terminal, you need to type <code>gmx</code> followed by
                    the
                    name of the command and its options.
                </p>
                <p class="note"> A help menu for all commands can be displayed with <code>&dash;h</code> (
                    e.g. <code>gmx pdb2gmx &dash;h</code>).</p>
                <p>
                    A useful resource when getting started with GROMACS is the <a
                        href="https://manual.gromacs.org/documentation/current/user-guide/mdp-options.html">GROMACS user
                    guide</a>.
                </p>
                <p>Usage of <code>pdb2gmx</code>:</p>
                <blockquote>
                    <pre>$ gmx pdb2gmx &dash;f protein.pdb &dash;o protein.gro &dash;p protein.top &dash;ignh</pre>
                    <p>What do each of the options stand for?</p>
                    <code>&dash;f</code> specifies the input <code>.pdb</code> file<br>
                    <code>&dash;o</code> specifies the output coordinate <code>.gro</code> file<br>
                    <code>&dash;p</code> specifies the output topology <code>.top</code> file<br>
                    <code>&dash;ignh</code> specifies that hydrogen atoms should be ignored<br>
                </blockquote>
                <p>GROMACS will ask you to choose a force field. Select <code>CHARMM27</code> by <b>typing the
                    corresponding number</b>, then hit <code>Enter</code>.</p>
                <p>When prompted for the water model, select <code>SPC</code>.</p>
            </li>
        </ul>
    </div>
    <div class="bbox">
        <h3 id="Inspecting_the_pdb2gmx_output_files"></h3>
        <ol>
            <li>Inspect the <code>pdb2gmx</code> output files</li>
            <li>Use the <code>ls &dash;lrth</code> command to list all files in your working directory.<br>
                You should find the newly generated <code>.gro</code> and <code>.top</code> files.
                <p>Which files were generated?</p>
            </li>
            <li>Inspect the output files using <code>more</code> or <code>less</code>.
                Example for <code>protein.gro</code>:
                <blockquote>
                    <pre>$ more protein.gro</pre>
                    <pre>$ less protein.gro</pre>
                    To scroll down use <code>Space</code>, to exit the viewer press <code>Ctrl+C</code> or
                    <code>q</code>.

                    <p>What information do each of these files contain?
                    <ol>
                        <li><code>protein.gro</code> contains the protein coordinates in GROMACS format. Note that the
                            file contains
                            information
                            about the protein amino acid residue names (e.g.&nbsp;<code>LEU</code>, <code>GLY</code>,
                            ...)
                            and atom names (e.g.&nbsp;<code>C</code>, <code>CA</code>, <code>O</code>, <code>N</code>,
                            ...)
                            inside the residues. These descriptors link to the force
                            field parameters included in the topology file
                        </li>
                        <li><code>protein.top</code> contains information about the topology of your system. It includes
                            the information
                            on the
                            connectivity between atoms and the force field parameters used to calculate bonded and
                            non&dash;bonded interactions between atoms.
                            <p>Some of these parameters can be defined in external files. Near the top of the
                                <code>.top</code> file, you will see a line like this:</p>
                            <pre><code>#include &quot;charmm27.ff/forcefield.itp&quot;</code></pre>
                            <p>
                                This line is a link to one of the files in the <code>charmm27.ff</code> force field
                                directory.
                                These contain information on the force field parameters for the <abbr>CHARMM27</abbr>
                                force field.
                            </p>
                            <p>As you use <code>Space</code> to scroll down in the topology file, you will see entries
                                for
                                atom types, charges, bonds, angles, dihedral types, etc. To exit the <code>more</code>
                                or
                                <code>less</code> view, press <code>Ctrl+C</code> or <code>q</code>.
                            </p>
                            <p>
                                At the bottom of the file, within the <code>[ molecules ]</code> section, you will find
                                a list of all molecules that are present in the system. Keep an eye on how this section
                                changes as you add solvent and ions to the system.
                            </p>
                            <p class="note">A useful command to view the end of a file is <code>tail</code>. For
                                example,
                                to view the last 10 lines of the <code>protein.top</code> file, you can use the command
                                <code>tail &dash;n 10 protein.top</code>.
                            </p>
                            <p>At the moment, the system section only contains one protein chain:</p>
                            <pre>
[ molecules ]
; Compound        #mols
Protein_chain_A     1</pre>
                        </li>
                        <li><code>posre.itp</code> is another topology file, but it contains parameters for position
                            restraints of all the heavy atoms in the original pdb file.
                            later on, we will use these to restrain the protein during the initial <abbr>MD</abbr>
                            simulation part.
                        </li>
                    </ol>
                    </p>
                </blockquote>
        </ol>
    </div>

    <h3 class="enum" id="toc_2_4">Creating a simulation box around the protein</h3>
    <p>
        Before moving on to add solvent and ions, you need to create a box around the protein into which these can be
        inserted.
    </p>
    <div class="bbox">
        <h3 id="Creating_a_box"></h3>
        <ol>
            <li>Use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-editconf.html"><code>editconf</code></a>
                to create a box around the protein
            </li>
            <li>Add a dodecahedron shaped box with a minimum distance of 1.0&nbsp;nm between the protein and box
                edge.<br>
                This minimal distance is necessary to avoid direct interactions between periodic protein images. In this
                case,
                no two neighbour proteins in adjacent boxes will be closer than 2.0&nbsp;nm to each other.
                Usage of <code>editconf</code>:
                <blockquote>
                    <pre>$ gmx editconf &dash;f protein.gro &dash;o protein&dash;pbc.gro &dash;bt dodecahedron &dash;d 1.0 &dash;c</pre>
                    <p>What does each of the options stand for?</p>
                    <code>&dash;f</code> specifies the input coordinate file<br>
                    <code>&dash;o</code> specifies the output coordinate file<br>
                    <code>&dash;bt</code> specifies the box type<br>
                    <code>&dash;d</code> specifies the minimum distance in nm between the protein and the box edge<br>
                    <code>&dash;c</code> specifies that the protein should be centred in the box<br>

                    <p class="note">The box does not have to be cubic in order to be periodic (think of honeycombs).
                        For spherical proteins, an obvious choice might be a rhombic dodecahedron as periodic box,
                        because it
                        corresponds closely to a spherical shape, and unlike a sphere, it can be packed periodically to
                        fill
                        the space.
                    </p>
                </blockquote>
            </li>
            <li>
                Use the <code>tail</code> command to inspect the end of the new <code>protein-pbc.gro</code> file and
                check how the
                box is defined.<br>
                <blockquote>
                    <p class="note">
                        GROMACS uses a triclinic matrix representation, with the first three numbers specifying the
                        diagonal
                        elements (<em>xx</em>, <em>yy</em>, <em>zz</em>) and the last six giving the off&dash;diagonal
                        elements (<em>xy</em>, <em>xz</em>, <em>yx</em>, <em>yz</em>, <em>zx</em>, <em>zy</em>).
                    </p>
                </blockquote>
            </li>
            <li>Use <abbr>VMD</abbr> to visualise the protein inside the box.<br>
                <p>
                    Inside the terminal type <code>vmd protein&dash;pbc.gro</code> to open the protein structure in
                    <abbr>VMD</abbr>.
                    <br>
                    Then, after the <abbr>VMD</abbr> window opens, add the box to the visualisation:
                    Inside the same terminal/console window, type <code>pbc box</code> after <code>vmd &gt;</code>.
                </p>
                <blockquote>
                    <p class="note">You might need to first hit <code>Enter</code> to get the <abbr>VMD</abbr> window to
                        update and
                        display the <code>vmd &gt;</code> line.</p></blockquote>
            </li>
        </ol>
        <div class="flex-figure">
            <div class="flex-figure-img" style="width: 50%">
                <figure>
                    <img src="img/protein-pbc.png" width="100%">
                    <figcaption>1xyw protein structure inside the simulation box visualised in <abbr>VMD</abbr>.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <!--    <h3 class="enum" id="toc_2_5">Running an energy minimisation on the protein structure</h3>-->
    <!--    <p>-->
    <!--        Now that you have a protein structure with a topology and a box, you can run an energy minimisation simulation.-->
    <!--        This will allow you to relax the structure and remove any steric clashes that might have been introduced during-->
    <!--        the previous steps.-->
    <!--    </p>-->
    <!--    <p>For this step you will need an <code>.mdp</code> file which specifies the <abbr>MD</abbr> run parameters.</p>-->
    <!--    <p>All <code>.mdp</code> files that you are going to need for this tutorial are stored in the-->
    <!--        <code>MDP/</code> directory.</p>-->
    <!--    <div class="bbox">-->
    <!--        <h3 id="Copying_the_run_parameter_files"></h3>-->
    <!--        <ul>-->
    <!--            <li>Copy all the <code>.mdp</code> files into your current working directory.</li>-->
    <!--            <li><pre>-->
    <!--cp ~/practical/Session2/MDP/* .</pre>-->
    <!--            </li>-->

    <!--        </ul>-->
    <!--    </div>-->
    <!--    <p>-->
    <!--        For the energy minimisation simulation, we will use <code>minim.mdp</code>.</p>-->
    <!--    <p>In GROMACS, you need to <strong>first compile</strong> the structure, topology and run parameter files, and-->
    <!--        <strong>then run</strong> the simulation.-->
    <!--        The compilation is performed with the <code>grompp</code> command. This step is also useful as it will pick-->
    <!--        up any errors from the setup procedure.</p>-->

    <!--    <div class="bbox">-->
    <!--        <h3 id="Running_the_protein_energy_minimisation"></h3>-->
    <!--        <ol>-->
    <!--            <li>-->
    <!--                Run an energy minimisation of the protein structure-->
    <!--            </li>-->
    <!--            <li>-->
    <!--                Look through the <code>minim.mdp</code> parameter file, every keyword is described with a comment (after-->
    <!--                the&nbsp;<code>;</code>),-->
    <!--                for the full information see <a-->
    <!--                    href="https://manual.gromacs.org/documentation/current/user-guide/mdp-options.html">manual.gromacs.org/documentation/current/user&dash;guide/mdp&dash;options.html</a>-->
    <!--            </li>-->
    <!--            <li>-->
    <!--                Compile the structure, topology and parameter files with <a-->
    <!--                    href="https://manual.gromacs.org/current/onlinehelp/gmx-grompp.html"><code>grompp</code></a>:-->
    <!--                <blockquote>-->
    <!--                    <pre>gmx grompp &dash;v &dash;f MDP/minim.mdp &dash;c protein&dash;pbc.gro &dash;p protein.top</pre>-->
    <!--                    <code>&dash;v</code> specifies that the output should be verbose.<br>-->
    <!--                    <code>&dash;f</code> specifies the input run parameter <code>.mdp</code> file.<br>-->
    <!--                    <code>&dash;c</code> specifies the input coordinate file.<br>-->
    <!--                    <code>&dash;p</code> specifies the topology file.<br>-->
    <!--                    <p class="note">This step will generate a compiled topology with the default name-->
    <!--                        <code>topol.tpr</code>-->
    <!--                        and an <code>.mdp</code> file with all the run parameters and the default name-->
    <!--                        <code>mdout.mdp</code>-->
    <!--                    </p>-->
    <!--                </blockquote>-->
    <!--            </li>-->
    <!--            <li>Run the energy minimisation with <a-->
    <!--                    href="https://manual.gromacs.org/current/onlinehelp/gmx-pdb2gmx.html"><code>mdrun</code></a>:<br>-->
    <!--                <blockquote>-->
    <!--                    <pre>gmx mdrun &dash;v</pre>-->
    <!--                    <code>&dash;v</code> specifies that the output should be verbose.-->
    <!--                    <p class="note">If no input file names are specified, <abbr>GROMACS</abbr> will look for files with-->
    <!--                        the default names, in this case <code>topol.tpr</code>.-->
    <!--                    </p>-->
    <!--                    <p class="note">Since we did not specify the name of names of an output <code>.gro</code> file,-->
    <!--                        <abbr>GROMACS</abbr> will use the default name <code>confout.gro</code>. Any old files with the-->
    <!--                        same-->
    <!--                        name will be first backed up to <code>#confout.gro.1#</code> and then overwritten.-->
    <!--                    </p>-->
    <!--                </blockquote>-->
    <!--            </li>-->
    <!--            <li>View the output file in <abbr>VMD</abbr>:<br>-->
    <!--                After the minimisation is finished, the final coordinates will be written to-->
    <!--                <code>confout.gro</code>.<br>-->
    <!--                Open the energy minimised structure in <abbr>VMD</abbr>:-->
    <!--                <blockquote>-->
    <!--                    <pre>vmd confout.gro</pre>-->
    <!--                </blockquote>-->
    <!--            </li>-->
    <!--            <li>Inspect the energy minimised structure in <abbr>VMD</abbr>-->
    <!--        </ol>-->
    <!--        <div class="flex-figure">-->
    <!--            <div class="flex-figure-img">-->
    <!--                <figure>-->
    <!--                    <img src="img/protein-minim.png" width="50%">-->
    <!--                    <figcaption>1xyw protein structure after energy minimisation visualised in <abbr>VMD</abbr>.-->
    <!--                    </figcaption>-->
    <!--                </figure>-->
    <!--            </div>-->
    <h3 class="enum" id="toc_2_6">Solvating the protein in the periodic box</h3>
    <p>In the next step you can solvate the protein with <abbr>SPC</abbr> water. We chose this water model because it is
        simple and versatile.</p>
    <div class="bbox">
        <h3 id="Solvating_the_protein"></h3>
        <ol>
            <li>Solvate the protein with <abbr>SPC</abbr> water</li>
            <li>Make a copy of the topology <code>protein.top</code> file:
                <blockquote>
                    <pre>$ cp protein.top protein-solvated.top</pre>
                    <p class="note"><code>solvate</code> will overwrite the <code>.top</code> file so it is good to make
                        a copy of the unsolvated topology.</p>
                </blockquote>
            </li>
            <li>Use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-solvate.html"><code>solvate</code></a> to
                solvate the protein with <abbr>SPC</abbr> water:
                <blockquote>
                    <pre>$ gmx solvate &dash;cp protein-pbc.gro &dash;cs spc216.gro &dash;o protein&dash;solvated.gro &dash;p protein&dash;solvated.top</pre>
                    <code>&dash;cp</code> specifies the coordinate file of the system to solvate.<br>
                    <code>&dash;cs</code> specifies the water model coordinate file.<br>
                    <code>&dash;o</code> specifies the output coordinate file.<br>
                    <code>&dash;p</code> specifies the input and output topology file<br>
                    <p>GROMACS will try to fill the available space with solvent and update the number of water
                        (<code>SOL</code>) molecules in the output topology file.</p>
                    <p class="note">If a name for an output topology file is specified with
                        <code>&dash;p</code>, the solvent molecules will be added to the input topology file.
                    </p>
                </blockquote>
            </li>
            <li>Inspect the last 10 lines of the output <code>.top</code> file using the <code>tail</code> command.<br>
                How have these lines changed?
            </li>
        </ol>
    </div>
    <p>
        Under physiological conditions, the protein will be surrounded by ions. To mimic this, we will add
        0.15&nbsp;mol&nbsp;L<sup>-1</sup> of NaCl to the system.
        In addition, because proteins are often charged, it is important to neutralise the total charge before
        proceeding to the next simulation step.
        This can be done with the <code>&dash;neutral</code> option of the <code>genion</code> command.
    </p>
    <blockquote>
        <p class="note"><code>genion</code> is treated as a type of <abbr>MD</abbr> run. This means that for this step
            you will need an <code>.mdp</code> file which specifies the <abbr>MD</abbr> run parameters.<br>
            All <code>.mdp</code> files that you are going to need for this tutorial are stored in the
            <code>MDP/</code> directory. </p>
        <p class="note">In GROMACS, you need to <strong>first compile</strong> the structure, topology and
            run parameter files, and
            <strong>then run</strong> the simulation.
            The compilation is performed with the <code>grompp</code> command. This step is also useful as it will pick
            up any errors from the setup procedure.</p></blockquote>
    <div class="bbox">
        <h3 id="Adding_ions_to the system"></h3>
        <ol>
            <li>Use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-genion.html"><code>genion</code></a> to
                add 0.15&nbsp;mol&nbsp;L<sup>-1</sup> of NaCl to the system and neutralise
                the total charge
            </li>
            <li>
                Make a copy of the topology <code>protein-solvated.top</code> file:
                <blockquote>
                    <pre>$ cp protein-solvated.top protein-solvated-ions.top</pre>
                </blockquote>
            </li>
            <li>Generate a run <abbr>TPR</abbr> file for the system:
                <p>
                    <!--                    Since <code>genion</code> is a type of <abbr>MD</abbr> run, you need to first use-->
                    <!--                    <code>grompp</code> to-->
                    <!--                    generate a <code>TPR</code> file. -->
                    The contents of the <code>.mdp</code> input file are not important
                    for <code>genion</code>
                    this step, but it has to be given.
                    <!--                    Use <code>genion.mdp</code> inside the <code>MDP</code>-->
                    <!--                    directory.-->
                </p>
                <p>Usage of <code>grompp</code>:</p>
                <blockquote>
                    <pre>$ gmx grompp &dash;f MDP/genion.mdp &dash;c protein&dash;solvated.gro &dash;p protein&dash;solvated&dash;ions.top &dash;maxwarn 1</pre>
                    <!--                    &dash;o genion.tpr-->
                    <code>&dash;f</code> specifies the input run parameter file.<br>
                    <code>&dash;c</code> specifies the coordinate file of the system to solvate.<br>
                    <code>&dash;p</code> specifies the topology file.<br>
                    <code>&dash;maxwarn</code> specifies the maximum number of warnings that can be ignored.
                    If the protein has a charge, <code>grompp</code> will generate a warning that needs to be
                    ignored.<br>
                    <!--                    <code>&dash;o</code> specifies the compiled run <code>.tpr</code> file.<br>-->
                    <!--                    <p class="note"> Because <code>genion</code> is an <abbr>MD</abbr> run, the <code>&dash;pp</code>-->
                    <!--                        option-->
                    <!--                        to generate a new topology file with ions is used here rather than with the <code>genion</code>-->
                    <!--                        command.</p>-->
                    <p class="note">This step will generate a compiled topology with the default name
                        <code>topol.tpr</code>
                        and an <code>.mdp</code> file with all the run parameters and the default name
                        <code>mdout.mdp</code>.<br>
                        Any old files with the
                        same
                        name will be first backed up to <code>#topol.tpr.1#</code> or <code>#mdout.mdp.1#</code> and
                        then overwritten.

                    </p>
                </blockquote>
            </li>
            <li>
                Usage of <code>genion</code>:
                <blockquote>
                    <pre>$ gmx genion &dash;o protein&dash;solvated&dash;ions.gro &dash;p protein&dash;solvated&dash;ions.top &dash;pname NA &dash;nname CL &dash;conc 0.15 &dash;neutral</pre>
                    <!--                    <code>&dash;s</code> specifies the compiled input <code>.tpr</code> file of the system to-->
                    <!--                    solvate.<br>-->
                    <!--                    <code>&dash;s</code> specifies the compiled input <code>.tpr</code> file.<br>-->
                    <code>&dash;o</code> specifies the output coordinate file<br>
                    <code>&dash;p</code> specifies the input and output topology file<br>
                    <code>&dash;pname</code> specifies the name of the positive ion<br>
                    <code>&dash;nname</code> specifies the name of the negative ion<br>
                    <code>&dash;conc</code> specifies the concentration of ions in mol&nbsp;L<sup>-1</sup><br>
                    <code>&dash;neutral</code> specifies that the system should be neutralised<br>
                    <p>When asked which group of molecules should be replaced select the number for the <code>SOL</code>
                        group.</p>
                    <p class="note">If no input files are specified, <abbr>GROMACS</abbr> will look for files with
                        the default names, in this case <code>topol.tpr</code>.
                    </p>
                </blockquote>
            </li>
            <li>Use <code>grep</code> to check how many <em>NA</em> and <em>CL</em> ions were added to the system.<br>
                <code>grep</code> can be used to search for specific words in a file:<br>
                <blockquote>
                    For the topology file you can use:
                    <pre>$ grep NA protein-solvated-ions.top</pre>
                    For the coordinate file it can also be useful to pipe the output of <code>grep</code> into the
                    <code>wc &dash;l </code> command to count the number of lines that contain a specific word:
                    <pre>$ grep NA protein-solvated-ions.gro | wc &dash;l</pre>
                </blockquote>
            </li>
        </ol>
    </div>
</div>
<div class="box">
    <h2 id="toc_3">Running a molecular dynamics simulation</h2>
    <p>
        Now that the solvated protein system is prepared, you can get started with the <abbr>MD</abbr> simulation.
        Before running the actual simulation to generate data that can be analysed, it is important to first run some
        preparation steps to prevent the system from exploding due to atoms being too far apart or too close together
        and to
        slowly allow the system to reach an equilibrium state.
    </p>
    <p>
        Therefore, you will first run the following sequence of energy minimisation and equilibration steps:</p>
    <ol>
        <li>Energy minimisation</li>
        <li>
            Restrained <abbr>NVT</abbr>
            equilibration run
        </li>
        <li>
            Restrained <abbr>NPT</abbr>
            equilibration run
        </li>
        <li>
            Unrestrained <abbr>NPT</abbr>
            equilibration run
    </ol>
    <p>The three equilibration runs will require a bit more time and resources, so you will use Eddie HPC to
        run them.
    </p>
    <h3 class="enum" id="toc_3_1">Energy minimisation</h3>
    <p>
        A successful energy minimisation will result in a negative potential energy <code>Epot</code>.
        For a simple protein it will be in the order of 10<sup>4</sup> kJ&nbsp;mol<sup>-1</sup>,
        for a bigger solvated system 10<sup>5</sup> kJ&nbsp;mol<sup>-1</sup>.
        For the energy minimisation to be considered successful, the maximum force <code>Fmax</code> has to
        be below the tolerance value <code>emtol</code> specified in the run parameter file.
        Generally it will be less than 10<sup>4</sup> kJ&nbsp;mol<sup>-1</sup>&nbsp;<sup>-1</sup>. If
        <code>Fmax</code> is higher than this threshold, it indicates a problem in the initial atom
        configuration.</p>
    <div class="bbox">
        <h3 id="Minimising_the_energy"></h3>
        <ul>
            <li>Run an energy minimisation of the solvated protein structure
                <code>protein&dash;solvated&dash;ions.gro</code></li>
            <li>
                Use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-grompp.html"><code>grompp</code></a> to
                prepare the <code>.tpr</code> input file for the energy minimisation.<p>
                <blockquote>
                    <pre>$ gmx grompp &dash;v &dash;f MDP/minim.mdp &dash;c protein-solvated-ions.gro &dash;p protein-solvated-ions.top &dash;o em.tpr &dash;po em.mdp &dash;pp em.top</pre>
                    <p>
                        Use the <code>&dash;o</code>, <code>&dash;po</code> and <code>&dash;pp</code> options to set the
                        names of the output
                        <code>.tpr</code>, <code>.mdp</code> and <code>.top</code> files to <code>em.tpr</code>, <code>em.mdp</code>
                        and <code>em.top</code>
                        respectively.</p>
                </blockquote>
            </li>
            <li>
                Run the energy minimisation with <a href="https://manual.gromacs.org/current/onlinehelp/gmx-mdrun.html">
                <code>mdrun</code></a>.
                <blockquote>
                    <pre>$ gmx mdrun &dash;v &dash;s em.tpr &dash;deffnm em</pre>
                    <p>
                        Use the <code>&dash;deffnm</code> option to set the name of the output files to <code>em</code>
                        and
                        select <code>&dash;v</code> to get a verbose output.</p>
                    <p class="note">With the <code>&dash;v</code> flag, the energy and force evolution will be displayed
                        on
                        the screen.
                    </p>
                </blockquote>
            </li>
            <li>Visualise the final structure <code>em.gro</code> in VMD</li>

            <li>Open <code>em.gro</code> in VMD and create different representations for protein, water and NA and CL
                ions:
                <!--                    , use the <code>pbc box_draw</code> command to display the simulation box-->
                <ul>

                    <li>To create the new representations, like <a href="#change_rep">before</a> go to the <code>Graphics</code>
                        menu and select <code>Representations...</code>
                    </li>
                    <li>
                        Click on <code>Create Rep</code> to create a new representation for the protein. Then type
                        <code>protein</code> in the <code>Selected Atoms</code> section and
                        change the Drawing Method to <code>NewCartoon</code>.
                    </li>
                    <li>Create a new representation for the water molecules with the selection command
                        <code>water</code>.
                        Set the coloring method to ColorID, select white as the colour, set the drawing method to <code>QuickSurf</code>
                        and the
                        Material to <code>Transparent</code>.
                    </li>
                    <li>
                        Create a new representation for the ions with the selection command <code> type NA CL</code>.
                        Set the coloring method to type, the drawing method to <code>VDW</code> and the Material to
                        <code>AOShiny</code>.
                    </li>
                    <li>Deactivate the default representations for protein, water and ions by double-clicking on the
                        first line in the <code>Graphical Representations</code> window.
                    </li>
                </ul>
            </li>
        </ul>
        <div class="flex-figure">
            <div class="flex-figure-img" style="width: 50%">
                <figure>
                    <img src="img/em_box.png" width="100%">
                    <figcaption>
                        <abbr>VMD</abbr> visualisation of protein system after energy minimisation with Newcartoon
                        representation for 1xyw protein structure, QuickSurf representation for water and VDW
                        representation for NA and CL ions.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <h3 class="enum" id="toc_3_2">Restrained equilibration runs</h3>
    <p>
        For this step, the positions of protein atoms will remain restrained, while water and ions are allowed to relax
        around it. Using a position restraints file, it is possible to restrain certain parts of the system only, by
        applying a penalty in the form of a harmonic potential that restricts the movement of selected atoms.
        In this case, we will restrain heavy atoms of the protein.
    </p>
    <p>
        In the run parameter files for the restrained equilibrations, <code>nvt.mdp</code> and <code>npt.mdp</code>, the
        line reading
        <code>define = &dash;DPOSRES</code> will have the effect of globally defining the keyword <code>POSRES</code>
        which
        is then used to turn on position restraints in the topology file.
    </p>
    <p>
        In the first of the following runs, you will perform an equilibration run at constant volume and use temperature
        coupling to heat up your
        system from 0&nbsp;K to 300&nbsp; (<abbr>NVT</abbr> ensemble).
        The temperature is regulated by rescaling the velocities of the atoms in the system.
    </p>
    <p>
        In the second equilibration run, you will also add pressure coupling to equilibrate the system at 1&nbsp;bar
        (<abbr>NPT</abbr> ensemble).
        The pressure is regulated by scaling the box size.</p>
    <p>Regulating the
        temperature and pressure means that the simulation conditions will be closer to those in a real
        experiment or a living organism.
    </p>

    <div class="bbox">
        <h3 id="Equilibrating_the_system_at_constant_temperature"></h3>
        <ol>
            <li>Equilibrate the system at constant temperature (<abbr>NVT</abbr> ensemble) and with position restraints
                on the protein
            </li>
            <li>
                Open the topology file <code>em.top</code> in a text editor and find the line that specifies the
                position
                restraints for the protein.
            </li>
            <li>Copy the input files to your Eddie HPC scratch directory.<br>
                <pre>$ scp &dash;r ~/session2 &lt;UUN&gt;@eddie.ecdf.ed.ac.uk:/exports/eddie/scratch/&lt;UUN&gt;/</pre>
                <p class="note">
                    Replace <code>&lt;UUN&gt;</code> with your own university username.
                </p>
            </li>
            <li>Use <code>ssh &dash;X</code> to in to Eddie HPC and navigate to the <code>session2</code> directory.
                <pre>$ ssh &dash;X &lt;UUN&gt;@eddie.ecdf.ed.ac.uk</pre>
                <pre>$ cd /exports/eddie/scratch/&lt;UUN&gt;/session2/</pre>
                <p class="note">
                    Replace <code>&lt;UUN&gt;</code> with your own university username.
                </p>
                <p class="note">
                    The <code>&dash;X</code> option is used to enable X11 forwarding, which allows you to use the
                    graphical
                    interface needed to display plots on Eddie HPC.
            </li>
            <li>Prepare the submission script for the equilibration run on eddie:<br>
                <p>Use the <code>cp</code> command to copy the template <code>eddie_run.sh</code> to
                    <code>run_nvt.sh</code>, then
                    use the nano editor to open the <code>run_nvt.sh</code> script and insert the GROMACS commands to
                    compile and run the restrained
                    equilibration:
                <ol>
                    <li>Copy the template script.
                        <pre>$ cp eddie_run.sh run_nvt.sh</pre>
                    </li>
                    <li>Open run_nvt.sh and navigate to the end of the file.
                        <pre>nano run_nvt.sh</pre>
                    </li>
                    <li>
                        Add the required options to <a
                            href="https://manual.gromacs.org/current/onlinehelp/gmx-grompp.html"><code>grompp</code></a>
                        to
                        prepare the <code>.tpr</code> input file for the restrained equilibration.<br>
                        <blockquote>
                            <pre>$ gmx grompp &dash;v &dash;f MDP/nvt.mdp &dash;c em.gro &dash;p protein-solvated-ions.top &dash;r em.gro &dash;o
                                nvt.tpr &dash;po nvt.mdp &dash;pp nvt.top</pre>
                            <p>Use the <code>&dash;o</code>, <code>&dash;po</code>, <code>&dash;pp</code> options to set
                                the names of the
                                output
                                <code>.tpr</code>, <code>.mdp</code> and <code>.top</code> files to <code>nvt.tpr</code>,
                                <code>nvt.mdp</code> and <code>nvt.top</code>
                                respectively.</p>
                            <p>
                                Here, you will also need to provide a <code>&dash;r</code> option to specify a
                                coordinate file for the restraints which can be identical to the input coordinate file,
                                <code>em.gro</code>.
                            </p>
                        </blockquote>
                    </li>
                    <li>
                        Add the restrained equilibration with <a
                            href="https://manual.gromacs.org/current/onlinehelp/gmx-mdrun.html">
                        <code>mdrun</code></a>.<br>
                        <blockquote>
                            <pre>$ gmx mdrun &dash;v &dash;s nvt.tpr &dash;deffnm nvt &dash;nt 1 &dash;ntmpi 1</pre>
                            <p>Use the <code>&dash;deffnm</code> option to set the name of the output files to
                                <code>nvt</code>
                                and
                                select <code>&dash;v</code> to get a verbose output.</p>
                            <p>
                                Use the <code>&dash;nt</code> and <code>&dash;ntmpi</code> options to specify the number
                                of threads and MPI processes to use for the run.
                            </p>
                        </blockquote>
                    </li>
                </ol>
            </li>
            <li>Save the file with <code>Ctrl+O</code>, <code>Enter</code> and <code>Ctrl+X</code> and submit the run
                with <code>qsub</code><br>
                <pre>$ qsub run_nvt.sh</pre>
            </li>
            <li>
                Use <code>qstat</code> to check the status of the job.<br>
                <pre>$ qstat &dash;u &lt;UUN&gt;</pre>
            </li>
            <li>
                Once the run starts, check the evolution of the energy through the run with <a
                    href="https://manual.gromacs.org/current/onlinehelp/gmx-energy.html"><code>gmx energy</code></a>.
                <p class="note">If the run has started, <code>qstat</code> will show <code>r</code> (running)
                    instead of <code>qw</code> (in queue) as the job status.</p>
                <ul>
                    <li id="interactive_login">
                        For using the <code>gmx energy</code> command, you will need to start an interactive session on
                        a compute node on Eddie HPC.
                        <p>
                            Use the <code>qlogin</code> command to request an interactive session with 1&nbsp;G of
                            memory:
                        <pre>$ qlogin</pre>
                        <p>
                            Once the interactive session has started, navigate back to your scratch directory and run
                            the <code>load_gmx.sh</code>
                            script to load the GROMACS module:
                        </p>
                        <pre>$ cd /exports/eddie/scratch/<UUN>/session2/</pre>
                        <pre>$ source load_gmx.sh</pre>
                    </li>
                    <li>
                        Check temperature, pressure, potential and kinetic energy with <code>gmx energy</code>.<br>
                        <p>If the <code>nvt</code> run has not started yet, the input files for <code>gmx energy</code>
                            will
                            not be available so make sure the simulation is running before proceeding.</p>
                        <blockquote>
                            <pre>$ gmx energy &dash;f nvt.edr &dash;o nvt.xvg</pre>
                            <p>Choose <code>Total-Energy</code>, <code>Potential</code>
                                or <code>Kinetic-En</code> by entering the number next to the desired
                                energy term and pressing <code>Enter</code>.</p>
                            You will obtain an <code>energy.xvg</code> file that you can plot with <code>xmgrace</code>.
                            <p class="note">If you want to generate separate output files for each energy term, you can
                                use the
                                <code>&dash;o</code> option to specify a file name for each term
                                (e.g.&nbsp;<code>energy_kin.xvg</code>,
                                <code>energy_pot.xvg</code> and <code>energy_tot.xvg</code>).</p>
                        </blockquote>
                    </li>
                </ul>
            </li>
            <li>
                Plot the energy evolution with <code>xmgrace</code>.<br>
                Use the following command if you selected only one energy term:
                <blockquote>
                    <pre>$ xmgrace nvt.xvg</pre>
                </blockquote>
                Use the following command if you selected all three energy terms:
                <blockquote>
                    <pre>$ xmgrace &dash;nxy energy.xvg</pre>
                </blockquote>
                If you have saved each output into an individual file using the <code>&dash;o</code> option, resulting
                in,
                for example, <code>energy_kin.xvg</code>, <code>energy_pot.xvg</code> and <code>energy_tot.xvg</code>
                you can
                plot
                them together with:
                <blockquote>
                    <pre>$ xmgrace &dash;nxy energy_*.xvg &dash;legend load</pre>
                    <p class="note">
                        The <code>*</code> symbol is a <em>wildcard</em>, i.e. any file that starts with
                        <code>energy</code> and finishes with <code>.xvg</code> will be plotted.
                    </p>
                </blockquote>
            </li>
        </ol>
    </div>
    <p>
        Next, you will perform an equilibration run at constant temperature and pressure (<abbr>NPT</abbr> ensemble).
        This will allow the system to also reach the desired pressure.
    </p>
    <div class="bbox">
        <h3 id="Equilibrating_the_system_at_constant_temperature_and_pressure"></h3>
        <ol>
            <li>Equilibrate the system at constant temperature and pressure (<abbr>NPT</abbr> ensemble) with position
                restrains on the protein
            </li>
            <li>Write a <code>run_npt.sh</code> run submission script for the <abbr>NPT</abbr> equilibration run on
                Eddie HPC:<br>
                Follow the same procedure as in the <a href="#Equilibrating_the_system_at_constant_temperature">restrained
                    equilibration task</a>.<br>
                Use <code>MDP/npt.mdp</code> as the input run parameter file and <code>nvt.gro</code> as the input
                coordinate
                file. Add the <code>&dash;o</code>, <code>&dash;po</code> and <code>pp</code> options to set the names
                of the output
                <code>.tpr</code>, <code>.mdp</code> and <code>.top</code> files to <code>npt.tpr</code>,
                <code>npt.mdp</code> and <code>npt.top</code>.
                Set the
                output file name for <code>mdrun</code> to <code>npt</code>.<br>
                <ol>
                    <li>Copy the template script.
                        <pre>$ cp eddie_run.sh run_npt.sh</pre>
                    </li>
                    <li>Open run_npt.sh and navigate to the end of the file.
                        <pre>$ nano run_npt.sh</pre>
                    </li>
                    <li>Add the required options for <a
                            href="https://manual.gromacs.org/current/onlinehelp/gmx-grompp.html"><code>grompp</code></a>
                        and
                        <a href="https://manual.gromacs.org/current/onlinehelp/gmx-mdrun.html"><code>mdrun</code></a>.
                        <blockquote>
                            <pre>$ gmx grompp -v -f MDP/npt.mdp -c nvt.gro &dash;p protein-solvated-ions.top &dash;r nvt.gro -o npt.tpr -po npt
                                .mdp -pp npt.top</pre>
                            <pre>$ gmx mdrun -v -s npt.trp -deffnm npt -nt 1 -ntmpi 1</pre>
                        </blockquote>
                    </li>
                </ol>
            </li>
            <li>Submit the run with <code>qsub</code><br>
                <blockquote>
                    <pre>$ qsub run_npt.sh</pre>
                    <p class="note">
                        Make sure that the <code>run_nvt.sh</code> script has finished before submitting the <code>run_npt.sh</code>
                        script.
                    </p></blockquote>
            </li>
            <li>After the run has finished, use <code>energy</code> to check temperature, pressure, potential and
                kinetic
                energy evolution during the simulation. Follow the same procedure as in the <a
                        href="#Equilibrating_the_system_at_constant_temperature">restrained equilibration task</a>.<br>
            <li>
                Examine the <code>energy</code> output files with xmgrace and compare it to the <abbr>NVT</abbr>
                run.<br>
            </li>
        </ol>
    </div>
    <h3 class="enum" id="toc_3_4">Unrestrained equilibration run</h3>
    <p>
        Now that the system is equilibrated enough, you can take away the position restraints and continue to
        equilibrate
        the system at constant temperature and pressure (<abbr>NPT</abbr> ensemble).
    </p>
    <div class="bbox">
        <h3 id="Running_an_unrestrained_NPT_equilibration"></h3>
        <ol>
            <li>Run an unrestrained equilibration at constant temperature and pressure</li>
            <li>Write a <code>run_md.sh</code> run submission script for the unrestrained equilibration <abbr>MD</abbr>
                run on Eddie
                HPC:<br>
                Follow the same procedure as in the <a
                        href="#Equilibrating_the_system_at_constant_temperature_and_pressure">previous
                    task</a>.<br>
                Use <code>MDP/md.mdp</code> as the input run parameter file and <code>npt.gro</code> as the input
                coordinate
                file. Add the <code>&dash;o</code>, <code>&dash;po</code> and <code>&dash;pp</code> options to set the
                names of the output
                <code>.tpr</code>, <code>.mdp</code> and <code>.top</code> files to <code>md.tpr</code>,
                <code>md.mdp</code> and <code>md.top</code>. Set the
                output file name for <code>mdrun</code> to <code>md</code>.<br>
                <p class="note">Since this is an unrestrained equilibration run, you do NOT need to specify the
                    <code>&dash;r</code> option for the restraints file.
                </p>
                <ol>
                    <li>Copy the template script.
                        <pre>$ cp eddie_run.sh run_md.sh</pre>
                    </li>
                    <li>Open run_md.sh and navigate to the end of the file.
                        <pre>$ nao run_md.sh</pre>
                    </li>
                    <li>Add the required options for <a
                            href="https://manual.gromacs.org/current/onlinehelp/gmx-grompp.html"><code>grompp</code></a>
                        and
                        <a href="https://manual.gromacs.org/current/onlinehelp/gmx-mdrun.html"><code>mdrun</code></a>.
                        <blockquote>
                            <pre>$ gmx grompp -v -f MDP/md.mdp -c npt.gro &dash;p protein-solvated-ions.top -o md.tpr -po md.mdp -pp md.top</pre>
                            <pre>$ gmx mdrun -v -s md.trp -deffnm md -nt 1 -ntmpi 1</pre>
                        </blockquote>
                    </li>
                </ol>
            </li>
            <li>Open the <code>MDP/md.mdp</code> run parameter file and adjust the <code>nsteps</code> so that the run
                duration is 1&nbsp;ns and that the output trajectory contains 200 coordinate data points.<br>
                <blockquote>
                    <pre>$ nano MDP/md.mdp</pre>
                    <p class="note"> Make sure you provide the parameters for the <code>.mdp</code> file in the correct
                        units.
                        The units used by <abbr>GROMACS</abbr> can be found in the Reference Manual: <a
                                href="https://manual.gromacs.org/documentation/2019/reference-manual/definitions.html"
                                rel="noopener" target="_blank">manual.gromacs.org/documentation/2019/reference&dash;manual/definitions.html</a>.
                    </p>
                </blockquote>
            </li>
            <li>Submit the run with <code>qsub</code><br>
                <blockquote>
                    <pre>$ qsub run_md.sh</pre>
                    <p class="note">
                        Make sure that the <code>run_npt.sh</code> script has finished before submitting the <code>run_md.sh</code>
                        script.
                    </p></blockquote>
            </li>
        </ol>
    </div>
    <p>
        Looking at the output file of a previous simulation of a similar system, you can estimate that this simulation
        will take about 4&nbsp;hours to complete.
    </p>
    <pre>               Core t (s)   Wall t (s)        (%)
       Time:    13974.946    13974.947      100.0
                        3h52:54
                 (ns/day)    (hour/ns)
Performance:        6.183        3.882</pre>
    <p>
        Since the production run will take a bit longer to finish, you can continue this tutorial using the example
        files
        from a previous simulation. You can find them in the <code>/home/practical/session2/example_data</code>
        directory on your virtual machine.
    </p>
</div>
<!--    <p>For some of the analyses it can be useful to have a trajectory file that contains only the protein atoms. You-->
<!--        can-->
<!--        use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-trjconv.html"><code>trjconv</code></a> to-->
<!--        extract-->
<!--        the protein atoms from the trajectory file.</p>-->
<div class="box">
    <h2 id="toc_4">Analysis of the simulation data</h2>
    <p>
        In this section you will learn some ways to inspect the data generated in an <abbr>MD</abbr> simulation.
        You will
        <!--        :-->
        <!--    <ol>-->
        <!--        <li>-->
        calculate the root&dash;mean&dash;square deviation (<abbr>RMSD</abbr>).
        </li>
        <!--        <li>-->
        <!--            Extract the evolution of <em>x</em>, <em>y</em> and <em>z</em> coordinates and velocities of the protein-->
        <!--            over the duration of the simulation-->
        <!--        </li>-->
        <!--        <li>-->
        <!--            Calculate the radius of gyration of the protein-->
        <!--        </li>-->
        <!--            <li>-->
        <!--                Perform a hydrogen bond analysis for different parts of the protein-->
        <!--            </li>-->
        <!--    </ol>-->
    <h3 class="enum" id="toc_4_1">Calculating the root-mean-square deviation (<abbr>RMSD</abbr>)</h3>
    <p>
        The <abbr>RMSD</abbr> is a measure of the deviation of the protein structure from a reference structure.
        It is calculated as the square root of the average of the squared distances between the atoms of the protein
        in
        the reference structure and the atoms of the protein in the structure of interest.
    </p>
    <p>
        The <abbr>RMSD</abbr> is also an important measure to determine when a simulation has reached equilibrium.
        When the <abbr>RMSD</abbr> has reached a plateau, the system has reached equilibrium.
    </p>
    <p>
        It is only after the system has reached equilibrium that you are producing meaningful data that can be
        representative of the simulated system.
    </p>
    <div class="bbox">
        <h3 id="Calculating_the_RMSD"></h3>
        <ul>
            <li>Use <a href="https://manual.gromacs.org/current/onlinehelp/gmx-rms.html"><code>rms</code></a> to
                calculate the <abbr>RMSD</abbr> of the entire system, only the protein and only the backbone atoms
                of the
                protein.
            </li>
            <li>E.g.
                <blockquote>
                    <pre>$ gmx rms &dash;s md.gro &dash;f md.xtc &dash;o rmsd_system.xvg &dash;tu ns</pre>
                    <p class="note">Use the <code>&dash;o</code> option to specify a name under which you can find
                        the output file
                        again later.</p>
                    <p class="note">Use the <code>&dash; tu</code> option to specify the time unit for the output.
                    </p>
                </blockquote>
            </li>
            <li>
                Use xmgrace to plot and compare the <abbr>RMSD</abbr> of the entire system, the protein and the
                protein backbone.
            </li>
        </ul>
        <div class="flex-figure">
            <div class="flex-figure-img" style="width: 100%">
                <figure>
                    <img src="img/rmsd_system.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the RMSD evolution for the entire system during an unrestrained
                        equilibration run.
                    </figcaption>
                </figure>

            </div>
        </div>
        <div class="box">
            <h2 id="toc_5">Rendering a figure with VMD</h2>
            <p>
                It is useful to be able to produce an image of your simulation, for a report or a publication.
                For example, the image below is rendered with VMD.</p>
            <p>
                In this section we will learn how to do it. For this step you will use the <code>em.gro</code> file on
                your
                VM.
            </p>

            <div class="bbox">
                <h3 id="Rendering_a_figure_with_VMD"></h3>
                <ol>
                    <li>Render a figure of the protein in the simulation box with VMD</li>
                    <li>On the VM, load your system into the VMD.<br>
                        <pre>$ vmd em.gro</pre>
                        <p class="note">You can use the <code>em.gro</code> file as the input coordinate
                            file for this exercise. Once the production run has finished, you can copy the final
                            coordinate
                            file, <code>md.gro</code>
                            to your VM and render another figure.</p>
                    </li>
                    <li>Use <code>pbc wrap</code> to enter the protein in the box and wrap all atoms into the box:<br>
                        <blockquote id="wrap_protein">
                            <pre>vmd &gt; pbc wrap &dash;center com &dash;centersel &quot;protein&quot; &dash;compound residue &dash;all</pre>
                            <p>
                                <code>-center</code> specifies the centering method. Here, the center of mass the
                                protein
                                will be used as the center of the box.
                            </p>
                            <p>
                                <code>-centersel</code> specifies the selection of atoms that should be in the centre.
                            </p>
                            <p>
                                <code>-compound</code> specifies the grouping method. Here, the protein will be grouped
                                by
                                residue.
                            </p>
                            <p>
                                <code>-all</code> specifies that all atoms should be wrapped into the box.
                            </p>
                        </blockquote>
                    </li>
                    <li>Use <code>pbc box_draw</code> to draw the simulation box:<br>
                        <blockquote>
                            <pre>vmd &gt; pbc box_draw &dash;width 2 &dash;color black &dash;resolution 30</pre>
                        </blockquote>
                    </li>
                    <li>Change the background colour to white<br>
                        Select <code>Graphics</code> &rightarrow; <code>Colors...</code> then in the <code>Color
                            Controls</code>
                        window select <code>Display</code> in <code>Categories</code>
                        then <code>Background</code> in <code>Names</code> and <code>8 white</code> in
                        <code>Colors</code>.

                    </li>
                    <li>Change the display method to orthographic<br>
                        Select <code>Display</code> &rightarrow; <code>Orthographic</code>
                    </li>
                    <li>Turn off the axis display<br>
                        Select <code>Display</code> &rightarrow; <code>Axes</code> &rightarrow; <code>Off</code>
                    </li>
                    <li>Change the default representation style.<br>
                        <p>Like <a href="#change_rep">before</a> go to the <code>Graphics</code> menu and select <code>Representations...</code>
                        </p>
                        <ul>

                            <li>
                                Add new representations ions and the protein and change the Coloring Method, Drawing
                                Method
                                and Material.
                            </li>
                            <li>
                                Turn off the default representation.<br>
                                Double-click on the first line with selection <code>all</code> in the <code>Graphical
                                Representations</code> window.
                            </li>

                        </ul>
                    <li>
                        Take a snapshot of the representation:<br>
                        <ul>
                            <li>Exit the full screen mode of the virtual machine<br></li>
                            <li>Open the Snipping Tool application<br></li>
                            <li>Click on <code>New</code> and select the area of the screen you want to capture<br></li>
                            <li>Save the image as <code>protein.png</code>
                            </li>
                        </ul>
                        <div style="color: darkslategray; border: darkslategray; border-width: 1px; border-style: solid; background: aliceblue; padding: 10px">
                            <p class="note">The virtual machine does not have access to a GPU to produce really nice
                                renderings.
                                If you have access to a computer with a GPU, you can install VMD on it and use the
                                <code>Tachyon
                                    (internal, in-memory)</code> option to render
                                high-quality images:</p>
                            <ul style="text-align: left">
                                <li>Select <code>File</code> &rightarrow; <code>Render...</code></li>
                                <li>
                                    In the <code>File Render Controls</code> window, select <code>Tachyon
                                    (internal, in-memory)</code> as the rendering engine and
                                    select an output file name.
                                </li>
                                <li>
                                    You can then add the <code>&dash;res</code> and <code>&dash;aasamples</code> options
                                    to
                                    specify
                                    the
                                    resolution and
                                    anti&dash;aliasing samples, respectively.
                                </li>
                                <li>A rendering example with more advanced instructions can be found at <a
                                        href="https://skblnw.github.io/mkvmd_render/" rel="noopener" target="_blank">skblnw.github.io/mkvmd_render/</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ol>
                <div class="flex-figure">
                    <div class="flex-figure-item" style="width: 50%">
                        <figure>
                            <img alt="render.png" src="img/render_2.png" width="100%">
                            <figcaption>
                                Elk prion protein in a simulation box created with VMD: Backbone is shown in red, Na
                                ions
                                as
                                blue spheres, Cl ions as green spheres, water is shown as a surface representation, also
                                highlighting
                                the size of the simulation box.
                            </figcaption>
                        </figure>
                    </div>
                </div>
            </div>

            <!--    <h3 class="enum" id="toc_4_2">Calculating the radius of gyration of the protein</h3>-->


            <!--    <p>You may find you need to use the option<code>nt 2</code>(defines how many threads should be used to run the-->
            <!--        simulation). Since this is a small simulation, 2 threads is enough.</p>-->


            <!--    <p><span style="color: red;">-->
            <!--We now will run a very short (for typical MD) simulation of <strong>5 nanoseconds.</strong>-->
            <!--<strong>check and edit MDP file!</strong>-->
            <!--</span></p>-->

            <!--    <p>Use the <code>md.mdp</code> file and look at contents of it, you will need to edit it to make it run for <span-->
            <!--            style="color: red;"> 5000 ps or 5 ns </span> and to produce 1000 sets of coordinate data to the output.</p>-->

            <!--    <p>When your MDP file is ready, compile it with <code>grompp</code> and run with <code>mdrun</code>.</p>-->

            <!--    <p>From the output of your earlier simulations, you can know approximate performance on your computer. For-->
            <!--        example: </p>-->

            <!--    <div><pre><code>              Core t (s)   Wall t (s)        (%)-->
            <!--      Time:    24776.900     3097.115      800.0-->
            <!--                     51:37-->
            <!--                 (ns/day)    (hour/ns)-->
            <!--Performance:        1.395       17.206</code></pre>-->
            <!--    </div>-->

            <!--    <p>So you know approximately that this simulation will take-->
            <!--        <span style="color: red;"> ~100 hours. </span>-->
            <!--        This is also what you will find from the <code>gmx mdrun -v</code>. </p>-->

            <!--    <p>You can convert the trajectory with <code>gmx trjconv</code> to extract a smaller trajectory, or to remove water-->
            <!--        molecules, or to centre your protein in the box. Importantly you can unite together the bonds that will appear-->
            <!--        broken across the periodic boundary. </p>-->

            <!--    <div>-->
            <!--        <pre><code>gmx trjconv -o traj_center.xtc -center -pbc mol </code></pre>-->
            <!--    </div>-->

            <!--    <p>It will prompt you to select group for centering, which is <code>Protein</code> and the group for output. Choose-->
            <!--        <code>System</code>.</p>-->

            <!--    <p>Note, we have written out the .xtc format for the output. It is a compressed format, that will lighter for us-->
            <!--        to-->
            <!--        handle. Nevertheless, to load into VMD we need to have both the .gro file and the .xtc. </p>-->

            <!--    <h3 id="toc_16">12) Rendering the publication-ready figures with VMD</h3>-->

            <!--    <p>It is useful to be able to produce an image of your simulation, for a report or a publication. For example-->
            <!--        image-->
            <!--        below is rendered with VMD. In this section we will learn how to do it. </p>-->

            <!--    <p><img alt="render.png" src="Session2/render.png"></p>-->

            <!--    <p>Figure 2: Elk prion protein in a simulation box created with VMD: Backbone is shown in red, Na ions as blue-->
            <!--        spheres,-->
            <!--        Cl ions as green spheres, water is shown as a surface representation, also highlighting the size of the-->
            <!--        simulation-->
            <!--        box.</p>-->

            <!--    <p>Load your system into the VMD.</p>-->

            <!--    <div>-->
            <!--        <pre><code>vmd confout.gro </code></pre>-->
            <!--    </div>-->

            <!--    <p>Then in the <code>VMD Main</code> window, click on the line of confout.gro, selecting it. From here right-->
            <!--        click-->
            <!--        <code>Load Data Into Molecule...</code>, <code>Browse</code> to select the <code>traj_center.xtc</code>, VMD-->
            <!--        will-->
            <!--        automatically identify the format, press <code>Load</code>.</p>-->

            <!--    <p>Now, lets change the visualisation. </p>-->

            <!--    <ul>-->
            <!--        <li>Change the background to white: <code>Graphics &gt; Color &gt; Categories:Display &gt; Names:Background-->
            <!--            &gt;-->
            <!--            8-->
            <!--            white</code></li>-->
            <!--        <li>Change the display from perspective: <code>Display &gt; Orthographic</code></li>-->
            <!--        <li>Turn off the axis: <code>Display &gt; Axes &gt; Off</code></li>-->
            <!--    </ul>-->

            <!--    <p>It is up to you how you would like to represent this system, here are some suggestions.</p>-->

            <!--    <p>Go to <code>Graphics &gt; Representations</code> there you can <code>Create Rep</code> for each individual-->
            <!--        selection,-->
            <!--        choosing the way it is displayed, colours, materials. Tab <code>Selections</code> will assist you in-->
            <!--        <code>Keywords</code>, some tips:-->
            <!--        - <code>not water</code> will display everything but water;-->
            <!--        - a protein can be rendered showing only backbone-->
            <!--        - Drawing method <code>QuickSurf</code> is great to show the surface of an object, but should be done in-->
            <!--        transparent-->
            <!--        materials, such as <code>BlownGlass</code>;-->
            <!--        - Ions are best as <code>VDW</code>;-->
            <!--        - If you plan to render the image, good materials are the <code>AO</code> range ;-->
            <!--        - You may want to change the <code>Display &gt; Rendermode &gt; GLSL</code> to be able to see the visuals;-->
            <!--        - Note tha not every computer will display image in the same quality as it will be rendered.</p>-->

            <!--    <p>To render an image <code>File &gt; Render &gt; using Tachyon (internal, in-memory rendering) &gt; ...</code>-->
            <!--        <code>&gt; Browse /directory/NAME.png &gt; Start Rendering</code>, choosing the location and naming the-->
            <!--        file.-->
            <!--    </p>-->

            <!--    <p>More advanced instructions on achieving high quality images, as well as comparisons of renderings, can be-->
            <!--        found-->
            <!--        <a-->
            <!--                href="https://skblnw.github.io/mkvmd_render/">here</a>.</p>-->

            <!--    <h3 id="toc_17">13) Analysis of the simulation</h3>-->

            <!--    <h4 id="toc_18">RMSD</h4>-->

            <!--    <p>The first assessment is the root-mean-square deviation (RMSD) between the first frame and all the sequential-->
            <!--        ones. </p>-->
            <!--    <p>It can inform us on the convergence of the simulation and on the structural stability of our protein. The-->
            <!--        analysis is done with <code>gmx rms</code> command. We advise you to carry out yhe analysis for the whole-->
            <!--        system, as well as for the protein only and for the back-bone of the protein only.</p>-->

            <!--    <div><pre><code>gmx rms -f traj_center.xtc -o rmsd_system -tu ns-->
            <!--gmx rms -f traj_center.xtc -o rmsd_protein -tu ns-->
            <!--gmx rms -f traj_center.xtc -o rmsd_protein_bb -tu ns</code></pre>-->
            <!--    </div>-->

            <!--    <p>Compare these by plotting together with <code>xmgrace</code>.</p>-->

            <!--        <h4 id="toc_19">Radius of gyration</h4>-->

            <!--        <p>Radius of gyration allows us to access how compact is our protein and how it changes through time. If the-->
            <!--            radius-->
            <!--            of-->
            <!--            gyration does not change, the protein is stable and does not undergo unfolding events (which one would not-->
            <!--            realistically be able to observe on such a short simulation). </p>-->

            <!--        <p>Again, for protein-only calculate radius of gyration using <code>gmx gyrate</code> and plot it with-->
            <!--            <code>xmgrace</code></p>-->

            <!--        <div>-->
            <!--            <pre><code>gmx gyrate -f traj_center.xtc -o gyrate_protein.xvg</code></pre>-->
            <!--        </div>-->

            <!--        <h4 id="toc_20">Generating index file</h4>-->

            <!--        <p>Many Gromacs tools rely on using index files. These can be generated by <code>gmx make_ndx</code> tool:</p>-->

            <!--        <div>-->
            <!--            <pre><code>gmx make_ndx -f topol.tpr </code></pre>-->
            <!--        </div>-->

            <!--        <p>This tool allows to create groups of atoms for analysis. Lets make 3 groups, containing all hydrophilic, all-->
            <!--            hydrophobic and all amphiphatic amino acids, using their residue <code>r</code> names.</p>-->

            <!--        <p>When prompted by <code>&gt;</code> enter:</p>-->

            <!--        <ul>-->
            <!--            <li><code>r GLY PRO PHE ALA ILE LEU VAL</code></li>-->
            <!--            <li><code>r SER TYR ASP GLU CYS ASN GLN ARG HIS</code></li>-->
            <!--            <li><code>r LYS TRP TYR MET</code></li>-->
            <!--        </ul>-->

            <!--        <p>If you now hit enter, it will show you the lists made. The entries we generated look a bit untidy, so we can-->
            <!--            rename-->
            <!--            them by typing <code>name</code> followed by group number, followed by the name you want to give it, i.e.:-->
            <!--        </p>-->

            <!--        <ul>-->
            <!--            <li><code>name 17 Phobe</code></li>-->
            <!--            <li><code>name 18 Phil</code></li>-->
            <!--            <li><code>name 19 Amphi</code></li>-->
            <!--        </ul>-->

            <!--        <p>to write out the <code>index.ndx</code>, type</p>-->

            <!--        <ul>-->
            <!--            <li><code>q</code></li>-->
            <!--        </ul>-->

            <!--        <h4 id="toc_21">Hydrogen bonds</h4>-->

            <!--        <p>Run the H-bond 3 times, to analyse each of your groups against water, for example:</p>-->

            <!--        <div>-->
            <!--            <pre><code>gmx hbond -f traj_center.xtc -n index.ndx -num hbnum_phil.xvg</code></pre>-->
            <!--        </div>-->

            <!--        <p>Selecting group <code>18</code> for hydrophilic groups and <code>12</code> for water (or the numbers-->
            <!--            corresponding to-->
            <!--            these in your index).</p>-->

            <!--        <p>Plot all three sets together </p>-->

            <!--        <div>-->
            <!--            <pre><code>xmgrace hbnum_* -legend load </code></pre>-->
            <!--        </div>-->

            <!--        <p>While the data will not be normalised by the number of residues of each type, hopefully you should still be-->
            <!--            able-->
            <!--            to-->
            <!--            see how the number of H-bonds changes with simulation, with large numbers early on, when system is still-->
            <!--            actively-->
            <!--            equilibrating (see RMSD and energy), and slowly reducing over time, with significantly less H-bonds formed-->
            <!--            by-->
            <!--            hydrophobic groups and a large number by hydrophilic. T</p>-->


            <h2 id="toc_6">Reporting on the procedure</h2>
            <p>
                A handy tool to produce a summary of your system info is <a
                    href="https://manual.gromacs.org/current/onlinehelp/gmx-report-methods.html"><code>report-methods</code></a>.
            </p>
            <div class="bbox">
                <h3 id="Generating_a_report_of_the_procedure"></h3>
                <ul>
                    <li>Use <a
                            href="https://manual.gromacs.org/current/onlinehelp/gmx-report-methods.html"><code>report-methods</code></a>
                        to print a report of the procedure:
                    </li>
                    <li>Usage of <code>report-methods</code>:
                        <blockquote>
                            <pre>$ gmx report-methods &dash;s md.tpr</pre>
                            <p class="note">Use the <code>&dash;o</code> option to write the report as a plain
                                <code>.out</code>
                                text file and the <code>&dash;m</code> option to write the report as a LaTeX formatted
                                <code>.tex</code>.
                                You will hear more about writing documents in LaTeX in the upcoming sessions.</p>
                            <p>Your output will look similar to this:</p>
                            <pre>           :-) GROMACS - gmx report-methods, 2023.3 (-:

Executable:   /exports/applications/apps/SL7/gromacs/2023.3/gromacs_final/bin/gmx
Data prefix:  /exports/applications/apps/SL7/gromacs/2023.3/gromacs_final
Working dir:  /exports/eddie/scratch/s2123329
Command line:
    gmx report-methods &dash;s md.tpr

Reading file md.tpr, VERSION 2023.3 (single precision)
section: Methods
subsection: Simulation system
A system of 9246 molecules (29398 atoms) was simulated.

subsection: Simulation settings
A total of 1 ns were simulated with a time step of 2 fs.
Neighbor searching was performed every 10 steps.
The PME algorithm was used for electrostatic interactions.
with a cut-off of 1.2 nm.
A reciprocal grid of 64 x 64 x 64 cells was used with 4th order B-spline interpolation.
A single cut-off of 1.2 nm was used for Van der Waals interactions.
Temperature coupling was done with the V-rescale algorithm.
Pressure coupling was done with the Berendsen algorithm.

GROMACS reminds you: &quot;Furious activity is no substitute for understanding.&quot; (H.H. Williams)</pre>
                        </blockquote>
                    </li>
                </ul>
            </div>
        </div>
        <script src="../scripts/generate_header.js"></script>
        <script src="../scripts/generate_overview.js"></script>
        <script src="../scripts/scroll_up.js"></script>
        <script src="../scripts/feedback.js"></script>
        <script>window.onload = function () {
            addFeedback('https://forms.office.com/e/NtN4Fmzhj3?origin=lprLink', 'img/FB2.png');
            generateOverview();
            generateHeader();
            scrollUp();
        }</script>
</body>
</html>
