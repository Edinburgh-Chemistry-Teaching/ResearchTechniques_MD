<!DOCTYPE html>
<html lang="en-UK">
<!--xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">-->

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
    <meta content="Session 3: Advanced Protein Simulation" name="description"/>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,400;0,600;1,400&display=swap"
          rel="stylesheet">
    <link href="../../scripts/style.css" rel="stylesheet"/>
    <title>Part 3 &ndash; Analysis of the Simulation Data</title>
</head>

<body>

<div class="box">
    <h1 id="title">Part 3 &ndash; Analysis of the Simulation Data</h1>
    <p> &uarr; <a href="Session3.html">Go to the main menu</a> <br>
        &larr; <a href="part2.html">Go to the previous part &ndash; Running a Molecular Dynamics Simulation</a> </p>
</div>

<div class="box">
    <h2 id="overview">Contents</h2>
</div>

<div class="box">
    <h2 class="enum" id="toc_1">Analysis of the equilibration</h2>
    <p>
        As in the previous session, you should check that your system has equilibrated by looking at the temperature and pressure evolution.
    </p>
    <div class="bbox">
        <h3 id="Calculate_the_temperature_evolution"></h3>
        <ol>
            <li>
                Visualise the temperature evolution
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>Refer to the <a href="../../session2/part3.html#Calculate_the_temperature_evolution">Session 2</a> for instructions on
                how to calculate the temperature evolution of the system.
            </li>
            <li>Visualise the result in xmgrace. Has the temperature of your system equilibrated?
            </li>
            <li>Save the xmgrace plot as a <code>.png</code> file:
                <ol>
                    <li>In the xmgrace window open the <code>File</code> menu and select <code>Print setup</code></li>
                    <li>In the <code>Device setup</code> field <code>PNG</code></li>
                    <li>Set the file path in the <code>Output</code> field and include the <code>.png</code>
                        suffix.
                    </li>
                    <li>Click <code>Apply</code> and <code>Accept</code></li>
                    <li>In the <code>File</code> menu, click <code>Print</code>.</li>
                </ol>
            </li>
        </ol>
        <div class="flex-figure" style="margin-top:-8mm;">
            <div class="figure" style="width: 70%">
                <figure>
                    <img src="img/temp.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the temperature evolution during <em>NVT</em> and <em>NPT</em> equilibration.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>

    <div class="bbox">
        <h3 id="Calculate_the_pressure_evolution"></h3>
        <ol>
            <li>
                Visualise the pressure evolution
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>Refer to the <a href="../../session2/part3.html#Calculate_the_pressure_evolution">Session 2</a> for instructions on
                how to calculate the pressure of the system.
                <blockquote style="margin-top:1mm">
                    <p>Remember to vary the length of average until you find the best length to visualise the data trend.</p>
                </blockquote>
            </li>
            <li>Visualise the result in xmgrace. Has the pressure of your system equilibrated?
            </li>
            <li>Save the xmgrace plot as a <code>.png</code> file.
            </li>
        </ol>
         <div class="flex-figure" style="margin-top:-8mm;">
            <div class="figure" style="width: 70%">
                <figure>
                    <img src="img/pres.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the pressure evolution during <em>NPT</em> equilibration.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
</div>

<div class="box">
    <h2 class='enum' id="toc_2">Analysis of the simulation data</h2>
    <p>In this section, you will:</p>
    <ul>
        <li>Calculate the root-mean-square deviation (<abbr>RMSD</abbr>) of the system to determine from which
            point on the system is equilibrated
        </li>
        <li>Determine the root-mean-square fluctuation (RMSF) of the protein to assess its flexibility </li>
        <li>Perform a principal component analysis (PCA) to determine the fundamental motions in the protein </li>
    </ul>
    <p><strong>For this section, you will first use the <code>example_data</code> we have provided. This is a 50 ns simulation of the system
        .</strong></p>
    <p>
        Before the analysis can begin, we must ensure that the protein molecule is whole, and not "jumping" from one edge of the central image to
        the other. For the analysis, we also need <code>.gro</code> and <code>.tpr</code> files with the protein centered.
    </p>
    <div class="bbox">
        <h3 id="Making_protein_whole"></h3>
        <ol>
            <li>
                Remove periodic boundary effects
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>
                Use <a href="https://manual.gromacs.org/documentation/2019/onlinehelp/gmx-trjconv.html" rel="noopener"
                       target="_blank"><code>gmx trjconv</code></a> to center the protein in the trajectory <code>.xtc</code> file
                <pre style="margin-top:1mm">$ gmx trjconv -s prod.tpr -f prod.xtc -o prod_centered.xtc -pbc mol -ur compact -center</pre>
                <blockquote style="margin-top:1mm">
                    <code>-s</code> specifies the input topology <code>.tpr</code> file <br>
                    <code>-f</code> specifies the input trajectory file <br>
                    <code>-o</code> specifies the output trajectory file <br>
                    <code>-pbc</code> specifies the type of periodic boundary condition treatment. We select <code>mol</code> which puts the center
                    of mass of the molecule in the box <br>
                    <code>-ur</code> specifies the unit cell representation for <code>-pbc</code> <br>
                    <code>-center</code> specifies that the system should be centered in the box <br>
                    <p style="margin-top:2mm">Then, for <strong>centering</strong> select <code>protein</code> and for <strong>output</strong>
                        select <code>system</code> </p>
                </blockquote>
            </li>
            <li>
                Use <a href="https://manual.gromacs.org/documentation/2019/onlinehelp/gmx-trjconv.html" rel="noopener"
                           target="_blank"><code>gmx trjconv</code></a> to center the protein in the coordinate <code>.gro</code> file
                <pre style="margin-top:1mm">$ gmx trjconv -s prod.tpr -f npt.gro -o prod_centered.gro -pbc mol -ur compact -center</pre>
                <blockquote style="margin-top:1mm">
                    <code>-s</code> specifies the input topology <code>.tpr</code> file <br>
                    <code>-f</code> specifies the input coordinate file <br>
                    <code>-o</code> specifies the output coordinate file <br>
                    <code>-pbc</code> specifies the type of periodic boundary condition treatment. We select <code>mol</code> which puts the center
                    of mass of the molecule in the box <br>
                    <code>-ur</code> specifies the unit cell representation for <code>-pbc</code> <br>
                    <code>-center</code> specifies that the system should be centered in the box <br>
                    <p style="margin-top:2mm">Then, for <strong>centering</strong> select <code>protein</code> and for <strong>output</strong>
                        select <code>system</code> </p>
                    <p class="note" style="margin-top:2mm">We use <code>npt.gro</code> for this as it is the first frame in <code>prod.xtc</code></p>
                </blockquote>
            </li>
            <li>
                Use <a href="https://manual.gromacs.org/documentation/2019/onlinehelp/gmx-grompp.html" rel="noopener"
                           target="_blank"><code>gmx grompp</code></a> to generate a <code>.tpr</code> file of the centered protein
                <pre style="margin-top:1mm">$ gmx grompp -f MDP/prod.mdp -c prod_centered.gro -p protein_solv_ions.top -o prod_centered.tpr</pre>
                <blockquote style="margin-top:1mm">
                    <code>-f</code> specifies the input parameter file <br>
                    <code>-c</code> specifies the input coordinate file <br>
                    <code>-p</code> specifies the input topology file <br>
                    <code>-o</code> specifies the output binary file <br>
                </blockquote>
            </li>
        </ol>
    </div>

    <h3 class="enum" id="toc_2_1">Calculating the root-mean-square deviation (<abbr>RMSD</abbr>)</h3>
    <p>
        The RMSD is an important measure to determine when a simulation has reached equilibrium. When the RMSD has reached a plateau, the system
        has reached equilibrium. With proteins, the side chains are often excluded from RMSD analysis as they are usually very flexible and their
        RMSD is not necessarily indicative of any real change in the protein.
    </p>
    <p>
        It is only after the system has reached equilibrium that you are producing meaningful data that can be representative of the simulated system.
    </p>
    <div class="bbox">
        <h3 id="Calculate_the_RMSD"></h3>
        <ol>
            <li>
                Calculate the <abbr>RMSD</abbr> of the protein backbone
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>Refer to the <a href="../../session2/part3.html#Calculating_the_RMSD">Session 2</a> for instructions on
                how to calculate the <abbr>RMSD</abbr> of the protein backbone.
            </li>
            <li>Visualise the result in xmgrace and determine the time point at which the system is equilibrated. You will <strong>begin the
                subsequent analyses starting from this time point</strong>.
            </li>
            <li>Save the xmgrace plot as a <code>.png</code> file.
            </li>
        </ol>
        <div class="flex-figure" style="margin-top:-8mm;">
            <div class="figure" style="width: 70%">
                <figure>
                    <img src="img/rmsd.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the RMSD evolution for the protein backbone during a production run.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <h3 class="enum" id="toc_2_2">Calculating the root-mean-square fluctuation (<abbr>RMSF</abbr>)</h3>
    <p>
        The RMSF is used to assess the flexibility of the protein by quantifying the oscillation of the target about an average position. It is
        usually computed for the alpha-carbon atoms and displayed as "per residue".
    </p>
    <div class="bbox">
        <h3 id="Calculate_the_RMSF"></h3>
        <ol>
            <li>
                Calculate the <abbr>RMSF</abbr> of the alpha-carbons
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>
                Use <a href="https://manual.gromacs.org/documentation/2019/onlinehelp/gmx-rmsf.html" rel="noopener"
                           target="_blank"><code>gmx rmsf</code></a> to calculate the protein flexibility:
                <pre style="margin-top:1mm">$ gmx rmsf -s prod_centered.tpr -f prod_centered.xtc -res -o rmsf.xvg</pre>
                <blockquote style="margin-top:1mm">
                    <code>-s</code> specifies the input topology <code>.tpr</code> file <br>
                    <code>-f</code> specifies the trajectory file <br>
                    <code>-o</code> specifies the output file <br>
                    <code>-b</code> specifies the start time for the analysis (in ps) <br>
                    <code>-d</code> specifies the direction to perform the analysis in <br>
                    <code>-dens</code> specifies the type of density to calculate <br>
                    <p style="margin-top:2mm">Then, select <code>C-alpha</code> by typing the group number and hitting <code>Enter</code> </p>
                </blockquote>
            </li>
            <li>Visualise the result in xmgrace. Which residues have a high RMSF? How do these compare to the residues with the most structural
                changes seen in VMD? Why do you think there is such a large RMSF at either end of the protein?
            </li>
            <li>Save the xmgrace plot as a <code>.png</code> file.
            </li>
        </ol>
        <div class="flex-figure" style="margin-top:-8mm;">
            <div class="figure" style="width: 70%">
                <figure>
                    <img src="img/rmsf.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the RMSD evolution for the protein backbone during a production run.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <h3 class="enum" id="toc_2_3">Performing principal component analysis (<abbr>PCA</abbr>)</h3>
    <p>
        Principal component analysis is a dimensionality reduction technique, that is used to determine fundamental motions in biomolecules. It is
        often difficult to identify these motions visually as both slow global motions and fast local fluctuations occur simultaneously. PCA involves
        computing a positional covariance matrix and diagonalising it to determine characteristic eigenvectors and their eigenvalues. The
        eigenvectors can then be used to visualise the slow motions in the biomolecule. The eigenvectors corresponding to the largest eigenvalues
        are called "principal components".
    </p>
    <div class="bbox">
        <h3 id="Calculate_the_covariance matrix"></h3>
        <ol>
            <li>
                Calculate the covariance matrix of the alpha-carbons
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>
                Use <a href="https://manual.gromacs.org/documentation/2019/onlinehelp/gmx-covar.html" rel="noopener"
                           target="_blank"><code>gmx covar</code></a> to compute the covariance matrix:
                <pre style="margin-top:1mm">$ gmx covar -s prod_centered.tpr -f prod_centered.xtc -tu ns -mwa</pre>
                <blockquote style="margin-top:1mm">
                    <code>-s</code> specifies the input topology <code>.tpr</code> file <br>
                    <code>-f</code> specifies the trajectory file <br>
                    <code>-tu</code> specifies the time unit <br>
                    <code>-mwa</code> specifies that mass-weighted analysis should be performed <br>
                    <p style="margin-top:2mm">Then, select <code>C-alpha</code> by typing the group number and hitting <code>Enter</code> for both
                    fitting and covariance analysis</p>
                </blockquote>
                <p>This will output the eigenvalues as <code>eigenval.xvg</code> and eigenvectors as <code>eigenvec.trr</code></p>
            </li>
            <li>Visualise the eigenvalues in xmgrace. You should see that the magnitudes get much smaller as the eigenvalue increases, with only a
                few contributing meaningfully to the dynamics of the protein.
            </li>
        </ol>
        <div class="flex-figure" style="margin-top:-8mm;">
            <div class="figure" style="width: 70%">
                <figure>
                    <img src="img/eigenval.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the first 20 eigenvalues for the alpha carbons during a production run.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <div class="bbox">
        <h3 id="Diagonalise_the_matrix"></h3>
        <ol>
            <li>
                Diagonalise the matrix
            </li>
            <li>
                Start an interactive session on Eddie:
                <p>
                    Use the instructions from <a href="../../session2/part3.html#interactive_login">Session 2</a> to
                    start an interactive session on Eddie and load the GROMACS module.
                </p>
            </li>
            <li>
                Use <a href="https://manual.gromacs.org/documentation/2019/onlinehelp/gmx-anaeig.html" rel="noopener"
                           target="_blank"><code>gmx anaeig</code></a> to diagonalise the matrix:
                <pre style="margin-top:1mm">$ gmx anaeig -s prod_centered.tpr -f prod_centered.xtc -v eigenvec.trr -proj proj.xvg -2d 2dproj.xvg
                -extr extreme.pdb -filt filtered.xtc -first 1 -last 1 -tu ns</pre>
                <blockquote style="margin-top:1mm">
                    <code>-s</code> specifies the input topology <code>.tpr</code> file <br>
                    <code>-f</code> specifies the trajectory file <br>
                    <code>-v</code> specifies the trajectory file <br>
                    <code>-proj</code> calculates projections of the trajectory on the eigenvectors <br>
                    <code>-2d</code> calculates a 2d projection of the trajectory on <code>-first</code> and <code>-last</code> eigenvectors<br>
                    <code>-extr</code> calculates two extreme projections along the trajectory on the average structure<br>
                    <code>-filt</code> filters the trajectory to show the motion only between the specified eigenvectors <br>
                    <code>-first</code> specifies the first eigenvector for analysis <br>
                    <code>-last</code> specifies the last eigenvector for analysis <br>
                    <code>-tu</code> specifies the time unit <br>
                    <p style="margin-top:2mm">Then, select <code>C-alpha</code> by typing the group number and hitting <code>Enter</code> for both
                    fitting and covariance analysis</p>
                </blockquote>
            </li>
            <li>Visualise
            </li>
        </ol>
        <div class="flex-figure" style="margin-top:-8mm;">
            <div class="figure" style="width: 70%">
                <figure>
                    <img src="img/eigenval.png" width="100%">
                    <figcaption>
                        Example Xmgrace plot of the first 20 eigenvalues for the alpha carbons during a production run.
                    </figcaption>
                </figure>
            </div>
        </div>
    </div>
    <h3 class="enum" id="toc_2_4">Analyse your own simulation</h3>
    <p> Once your simulation has finished running, perform the above analysis on your system and compare the results. In what ways are they
        similar, and in what ways are they different? Do you think 5 ns is long enough to capture the main movements of this system?
    </p>
</div>

<div class="box">
    <h2 class="enum" id="toc_3">Visualising the results</h2>
    <p>
        You can use the same procedures as in the previous session to visualise the trajectory.
    </p>
    <div class="bbox">
        <h3 id="Render_trajectory_in_VMD"></h3>
        <ol>
            <li>Visualise the system in <abbr>VMD</abbr></li>
            <li>Transfer the files you want to visualise to your VM:
                <pre style="margin-top:1mm">$ scp &lt;UUN&gt;@eddie.ecdf.ed.ac.uk:/exports/eddie/scratch/&lt;UUN&gt;/prod.gro ~/Desktop/session3/</pre>
                <pre style="margin-top:-2mm">$ scp &lt;UUN&gt;@eddie.ecdf.ed.ac.uk:/exports/eddie/scratch/&lt;UUN&gt;/prod.xtc ~/Desktop/session3/</pre>
            </li>
            <li>Follow the same procedure as in the <a href="../../session2/part3.html#Rendering_a_figure_with_VMD">previous session</a> to render
                    a figure of the system.
            </li>
            <li>Follow the same procedure as in the <a href="../../session2/part3.html#Visualise_a_trajectory_with_VMD">previous session</a> to
                    visualise the trajectory.
            </li>
        </ol>
    </div>
</div>


<div class="box">
    <h2>This brings us to the end of the session. Please return to the main menu and provide feedback if you have not done so already.</h2>
    <p> &uarr; <a href="Session3.html">Go to the main menu</a> <br>
        &larr; <a href="part2.html">Go to the previous part &ndash; Running a Molecular Dynamics Simulation</a> </p>
</div>

<script src="../../scripts/generate_header.js"></script>
<script src="../../scripts/generate_overview.js"></script>
<script src="../../scripts/scroll_up.js"></script>
<script src="../../scripts/feedback.js"></script>
<script src="../../scripts/adjust_for_dyslexia.js"></script>
<script>window.onload = function () {
    generateOverview();
    generateHeader();
    scrollUp();
    adjustForDyslexia()
}</script>
</body>
</html>
